<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CBE Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    /* Theme variables for dark mode (default) */
    :root {
      --bg-primary: #0b0b0b;
      --bg-secondary: #111;
      --bg-tertiary: #1c1c1c;
      --text-primary: #f5f5f5;
      --text-secondary: #ddd;
      --text-tertiary: #888;
      --accent: gold;
      --accent-hover: #ffd700;
      --button-bg: gold;
      --button-text: #000;
      --button-bg-hover: #ffd700;
      --border: #333;
      --border-footer: #222;
    }

    /* Theme variables for light mode */
    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --bg-tertiary: #e0e0e0;
      --text-primary: #333333;
      --text-secondary: #555555;
      --text-tertiary: #777777;
      --accent: #0066cc;
      --accent-hover: #004080;
      --button-bg: #0066cc;
      --button-text: #ffffff;
      --button-bg-hover: #004080;
      --border: #cccccc;
      --border-footer: #dddddd;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
    }

    /* Header styling */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    #themeToggle {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.3s;
    }

    #themeToggle:hover {
      color: var(--accent-hover);
    }

    /* Dashboard styling */
    .dashboard {
      padding: 20px;
    }

    .counters {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .section {
      margin-bottom: 40px;
    }

    /* Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      color: var(--text-primary);
    }

    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      background-color: var(--bg-secondary);
    }

    tr:nth-child(even) {
      background-color: var(--bg-tertiary);
    }

    table img {
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }

    /* Charts styling */
    .charts {
      display: flex;
      justify-content: space-around;
    }

    .charts canvas {
      max-width: 400px;
      background-color: var(--bg-primary);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .charts {
        flex-direction: column;
        align-items: center;
      }
      .charts canvas {
        max-width: 100%;
      }
    }

    /* Fade-in animation */
    .fade-in {
      opacity: 0;
      animation: fadeIn 0.5s ease-in forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
  </style>
</head>
<body>

  <!-- Header with theme toggle -->
  <header>
    <h1>CBE Admin Panel</h1>
    <button id="themeToggle" aria-label="Toggle theme">ðŸŒ“</button>
  </header>

  <!-- Dashboard content -->
  <div class="dashboard">
    <div class="counters">
      <div>Total Users: <span id="totalUsers">0</span></div>
      <div>Verified Users: <span id="verifiedUsers">0</span></div>
    </div>

    <!-- Users Verification Section -->
    <div class="section">
      <h2>Users Verification</h2>
      <table id="usersTable" class="fade-in">
        <thead>
          <tr>
            <th>Email</th>
            <th>Name</th>
            <th>Status</th>
            <th>Registration Date</th>
            <th>Last Login</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Populated by JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Payment Approval Section -->
    <div class="section">
      <h2>Payment Approval</h2>
      <table id="paymentsTable" class="fade-in">
        <thead>
          <tr>
            <th>User</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Status</th>
            <th>Payment Method</th>
            <th>Transaction ID</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Populated by JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Trade History Section -->
    <div class="section">
      <h2>Trade History</h2>
      <table id="tradesTable" class="fade-in">
        <thead>
          <tr>
            <th>Date</th>
            <th>Asset</th>
            <th>Notes</th>
            <th>Screenshot</th>
            <th>Trade Type</th>
            <th>Quantity</th>
            <th>Price</th>
          </tr>
        </thead>
        <tbody>
          <!-- Populated by JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Charts Section -->
    <div class="charts">
      <canvas id="userStatusChart" class="fade-in"></canvas>
      <canvas id="paymentTrendsChart" class="fade-in"></canvas>
    </div>
  </div>

  <!-- External Libraries -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // Admin Panel Script
    // Uses dummy data for demonstration. Replace `dummyData` with database data later.

    // Dummy data (replace with real data from your database)
    const dummyData = {
      users: [
        { email: "user1@example.com", name: "User One", status: "Verified", registrationDate: "2023-01-01", lastLogin: "2023-05-01" },
        { email: "user2@example.com", name: "User Two", status: "Pending", registrationDate: "2023-02-01", lastLogin: "2023-04-01" },
        // Add more users as needed
      ],
      payments: [
        { user: "User One", amount: 100, date: "2023-03-01", status: "Approved", paymentMethod: "Credit Card", transactionId: "TX12345" },
        { user: "User Two", amount: 200, date: "2023-03-15", status: "Pending", paymentMethod: "PayPal", transactionId: "TX67890" },
        // Add more payments as needed
      ],
      trades: [
        { date: "2023-04-01", asset: "EUR/USD", notes: "Buy signal", screenshot: "url/to/screenshot", tradeType: "Buy", quantity: 1000, price: 1.2345 },
        { date: "2023-04-02", asset: "GBP/USD", notes: "Sell signal", screenshot: "url/to/screenshot", tradeType: "Sell", quantity: 500, price: 1.3456 },
        // Add more trades as needed
      ]
    };

    // Theme toggle function (no persistence since localStorage is not used)
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', newTheme);
      // Theme resets on page reload; save to database later for persistence.
    }

    // Attach theme toggle to button
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);

    // Render Users Table with DataTables
    function renderUsersTable(data) {
      const table = $('#usersTable').DataTable({
        data: data,
        columns: [
          { data: 'email' },
          { data: 'name' },
          { data: 'status' },
          { data: 'registrationDate' },
          { data: 'lastLogin' },
          { data: null, defaultContent: '<button>Verify</button>' }
        ]
      });
      // Dummy action for Verify button (replace with real functionality later)
      table.on('click', 'button', function() {
        alert('Verify user');
      });
    }

    // Render Payments Table with DataTables
    function renderPaymentsTable(data) {
      const table = $('#paymentsTable').DataTable({
        data: data,
        columns: [
          { data: 'user' },
          { data: 'amount' },
          { data: 'date' },
          { data: 'status' },
          { data: 'paymentMethod' },
          { data: 'transactionId' },
          { data: null, defaultContent: '<button>Approve</button>' }
        ]
      });
      // Dummy action for Approve button (replace with real functionality later)
      table.on('click', 'button', function() {
        alert('Approve payment');
      });
    }

    // Render Trades Table with DataTables
    function renderTradesTable(data) {
      const table = $('#tradesTable').DataTable({
        data: data,
        columns: [
          { data: 'date' },
          { data: 'asset' },
          { data: 'notes' },
          { data: 'screenshot', render: function(data) {
            return data ? `<img src="${data}" alt="Screenshot" width="50">` : 'No screenshot';
          } },
          { data: 'tradeType' },
          { data: 'quantity' },
          { data: 'price' }
        ]
      });
    }

    // Render User Status Pie Chart with Chart.js
    function renderUserStatusChart(users) {
      const statuses = users.reduce((acc, user) => {
        acc[user.status] = (acc[user.status] || 0) + 1;
        return acc;
      }, {});
      const labels = Object.keys(statuses);
      const data = Object.values(statuses);
      new Chart(document.getElementById('userStatusChart'), {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: ['#4caf50', '#f44336'] // Green for Verified, Red for Pending
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'User Status Distribution' }
          }
        }
      });
    }

    // Render Payment Trends Line Graph with Chart.js
    function renderPaymentTrendsChart(payments) {
      const paymentData = payments.reduce((acc, payment) => {
        const date = payment.date;
        acc[date] = (acc[date] || 0) + payment.amount;
        return acc;
      }, {});
      const labels = Object.keys(paymentData).sort();
      const data = labels.map(date => paymentData[date]);
      new Chart(document.getElementById('paymentTrendsChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Payments',
            data: data,
            borderColor: '#2196f3',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: { title: { display: true, text: 'Date' } },
            y: { title: { display: true, text: 'Amount' } }
          }
        }
      });
    }

    // Update Dashboard Counters
    function updateCounters(data) {
      const totalUsers = data.users.length;
      const verifiedUsers = data.users.filter(user => user.status === 'Verified').length;
      document.getElementById('totalUsers').textContent = totalUsers;
      document.getElementById('verifiedUsers').textContent = verifiedUsers;
    }

    // Initialize the admin panel with dummy data
    renderUsersTable(dummyData.users);
    renderPaymentsTable(dummyData.payments);
    renderTradesTable(dummyData.trades);
    renderUserStatusChart(dummyData.users);
    renderPaymentTrendsChart(dummyData.payments);
    updateCounters(dummyData);
  </script>
</body>
</html>
