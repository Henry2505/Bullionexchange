<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Payment Options – CBE</title>
  <link rel="stylesheet" href="theme.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>
  <style>
    /* (keep your existing styles here) */
  </style>
</head>
<body>
  <!-- Logo & Theme Toggle… same as before -->

  <div class="container slide-in">
    <h1>Your Plan</h1>
    <div class="divider"></div>
    <div class="details-panel">
      <ul>
        <li><span>Plan:</span><span id="plan-name">—</span></li>
        <li><span>Price:</span><span id="plan-price">—</span></li>
        <li><span>You Save:</span><span id="plan-save">—</span></li>
      </ul>
    </div>

    <!-- Dynamic payment-method buttons will go here -->
    <div id="methods-container" class="slide-in"></div>

    <!-- Crypto section injected if needed -->
    <div class="crypto-section slide-in" id="cryptoSection">
      <div class="crypto-grid" id="cryptoGrid"></div>
    </div>

    <!-- No more file upload / proof input -->
    <a href="vip-subscription.html" class="back-link slide-in">← Change Plan</a>
  </div>

  <footer>© 2025 Chukwuemeka Bullion Exchange. All rights reserved.</footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Plan details (unchanged)
    const params = new URLSearchParams(location.search);
    const key = params.get('plan') || 'weekly';
    const cfg = {
      weekly:  {n:'Weekly Plan',  p:50,  s:0},
      monthly: {n:'Monthly Plan', p:150, s:50},
      yearly:  {n:'Yearly Plan',  p:1500, s:300}
    };
    const ch = cfg[key];
    document.getElementById('plan-name').textContent  = ch.n;
    document.getElementById('plan-price').textContent = `$${ch.p}`;
    document.getElementById('plan-save').textContent  = `$${ch.s}`;

    // Supabase init
    const SUPABASE_URL = 'https://dapwpgvnfjcfqqhrpxla.supabase.co';
    const SUPABASE_KEY = 'YOUR_ANON_KEY';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Load payment methods
    async function loadMethods() {
      const { data, error } = await supabase
        .from('payment_methods')
        .select('*')
        .order('id');
      if (error) return console.error(error);

      const container = document.getElementById('methods-container');
      container.innerHTML = '';
      data.forEach(m => {
        if (m.type === 'card') {
          // render a direct Pay button
          const btn = document.createElement('button');
          btn.className = 'btn-pay slide-in';
          btn.textContent = m.name;
          btn.onclick = () => window.location.href = JSON.parse(m.details).link;
          container.appendChild(btn);

        } else if (m.type === 'crypto') {
          // crypto toggle
          const btn = document.createElement('button');
          btn.className = 'btn-crypto slide-in';
          btn.textContent = m.name;
          btn.onclick = toggleCrypto;
          container.appendChild(btn);

          // add to crypto grid
          const obj = JSON.parse(m.details);
          const card = document.createElement('div');
          card.className = 'crypto-card';
          card.innerHTML = `
            <div class="label">${m.name}</div>
            <div class="address">${obj.address}</div>
            <button class="copy-btn">Copy</button>`;
          document.getElementById('cryptoGrid').appendChild(card);
        }
      });
    }

    function toggleCrypto() {
      const sec = document.getElementById('cryptoSection');
      if (sec.style.display === 'block') {
        sec.style.display = 'none';
      } else {
        sec.style.display = 'block';
      }
    }

    document.addEventListener('click', e => {
      if (e.target.matches('.copy-btn')) {
        const addr = e.target.previousElementSibling.textContent;
        navigator.clipboard.writeText(addr).then(() => {
          e.target.textContent = 'Copied!';
          setTimeout(() => e.target.textContent = 'Copy', 1500);
        });
      }
    });

    // initialize on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      loadMethods();
      // your existing slide-in logic, theme toggle, etc.
    });
  </script>
</body>
</html>
