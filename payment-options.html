<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Payment Options – CBE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
        rel="stylesheet"/>
  <style>
    /* Background & container */
    body {
      margin: 0; font-family: 'Poppins',sans-serif;
      background: #0b0b0b; color: #f5f5f5;
      overflow-x: hidden;
    }
    video.bg {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover; z-index: -2;
    }
    div.overlay {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); z-index: -1;
    }
    main.payment-container {
      max-width: 600px; margin: 100px auto;
      background: rgba(20,20,20,0.8);
      border-radius: 12px; padding: 30px;
      box-shadow: 0 0 20px rgba(255,215,0,0.4);
    }
    main.payment-container h1 {
      color: gold; text-align: center; margin-bottom: 10px;
    }
    main.payment-container p.plan-info {
      text-align: center; color: #ccc; margin-bottom: 30px;
    }

    /* Tabs */
    .tabs {
      display: flex; justify-content: center;
      margin-bottom: 20px;
    }
    .tabs button {
      background: #111; color: gold;
      border: 1px solid gold; flex: 1;
      padding: 10px; cursor: pointer;
      transition: background 0.3s;
    }
    .tabs button.active {
      background: gold; color: #000;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Form groups */
    .form-group { margin-bottom: 20px; }
    .form-group label {
      display: block; margin-bottom: 6px;
      color: #ccc;
    }
    .form-group input[type="email"],
    .form-group input[type="file"],
    .form-group select {
      width: 100%; padding: 10px;
      border: 1px solid #444; border-radius: 6px;
      background: #111; color: #f5f5f5;
    }

    /* Buttons */
    .btn-primary {
      display: block; width: 100%;
      background: gold; color: #000;
      border: none; padding: 12px;
      font-weight: bold; border-radius: 6px;
      cursor: pointer; transition: background 0.3s;
    }
    .btn-primary:hover { background: #e6c200; }

    /* Wallet display */
    .wallet-box {
      display: flex; align-items: center;
      gap: 10px; margin-top: 10px;
    }
    .wallet-box .address {
      flex: 1; background: #222; padding: 8px;
      border-radius: 4px; font-size: 14px;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <!-- Background Video -->
  <video class="bg" autoplay muted loop>
    <source src="star-video.MP4" type="video/mp4"/>
  </video>
  <div class="overlay"></div>

  <main class="payment-container">
    <h1>Choose Payment Method</h1>
    <p class="plan-info" id="planInfo">Loading plan…</p>

    <div class="tabs">
      <button id="tab-paystack" class="active">Paystack</button>
      <button id="tab-crypto">Crypto</button>
    </div>

    <!-- Paystack Tab -->
    <div id="paystack" class="tab-content active">
      <div class="form-group">
        <label for="emailPS">Email Address</label>
        <input type="email" id="emailPS" placeholder="you@example.com" required/>
      </div>
      <button class="btn-primary" id="btnPaystack">Pay with Paystack</button>
    </div>

    <!-- Crypto Tab -->
    <div id="crypto" class="tab-content">
      <div class="form-group">
        <label for="emailCR">Email Address</label>
        <input type="email" id="emailCR" placeholder="you@example.com" required/>
      </div>
      <div class="form-group">
        <label for="cryptoType">Cryptocurrency</label>
        <select id="cryptoType">
          <option value="">Select…</option>
          <option value="Bitcoin">Bitcoin</option>
          <option value="Ethereum">Ethereum</option>
          <option value="USDT">USDT</option>
        </select>
      </div>
      <div class="wallet-box">
        <div class="address" id="walletAddress">Not set</div>
        <button class="btn-primary" id="btnCopyWallet">Copy</button>
      </div>
      <div class="form-group">
        <label for="proofCR">Upload Proof</label>
        <input type="file" id="proofCR" accept="image/*"/>
      </div>
      <button class="btn-primary" id="btnSubmitCrypto">Submit Payment</button>
    </div>
  </main>

  <!-- Paystack inline -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script>
    (function(){
      // Load admin settings & package
      const settings = JSON.parse(localStorage.getItem('paymentSettings')||'{}');
      const wallets = {
        Bitcoin: settings.btc||'Not set',
        Ethereum: settings.eth||'Not set',
        USDT: settings.usdt||'Not set'
      };
      const pk = settings.paystackKey||'';
      const pkg = sessionStorage.getItem('selectedPackage')||'';
      const plans = { weekly:50, monthly:150, yearly:1500 };
      const planNames = {
        weekly:'Weekly VIP Plan — $50',
        monthly:'Monthly VIP Plan — $150',
        yearly:'Yearly VIP Plan — $1500'
      };
      const amount = (plans[pkg]||0) * 100;
      document.getElementById('planInfo').textContent = planNames[pkg] || 'No package selected';

      // Tab switching
      document.getElementById('tab-paystack').onclick = ()=>{ 
        document.getElementById('paystack').classList.add('active');
        document.getElementById('crypto').classList.remove('active');
        tabButtons('paystack');
      };
      document.getElementById('tab-crypto').onclick = ()=>{ 
        document.getElementById('crypto').classList.add('active');
        document.getElementById('paystack').classList.remove('active');
        tabButtons('crypto');
      };
      function tabButtons(active){
        document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
        document.getElementById('tab-'+active).classList.add('active');
      }

      // Paystack flow
      document.getElementById('btnPaystack').onclick = ()=> {
        const email = document.getElementById('emailPS').value.trim();
        if(!email || !email.includes('@')) return alert('Enter valid email');
        if(!pk) return alert('Paystack key missing in admin settings');
        let handler = PaystackPop.setup({
          key: pk,
          email: email,
          amount: amount,
          callback: resp => {
            // record
            let recs = JSON.parse(localStorage.getItem('paymentRecords')||'[]');
            recs.push({
              name: email.split('@')[0],
              email, username: email.split('@')[0],
              amount: plans[pkg]||0,
              method: 'Paystack',
              walletType: 'Paystack',
              proof: resp.reference,
              status: 'pending',
              submittedAt: new Date().toISOString()
            });
            localStorage.setItem('paymentRecords', JSON.stringify(recs));
            alert('Success! Ref: '+resp.reference);
            window.location.href = 'index.html';
          },
          onClose: ()=> alert('Payment cancelled')
        });
        handler.openIframe();
      };

      // Crypto flow
      document.getElementById('cryptoType').onchange = function(){
        document.getElementById('walletAddress').textContent = wallets[this.value] || 'Not set';
      };
      document.getElementById('btnCopyWallet').onclick = ()=> {
        const w = document.getElementById('walletAddress').textContent;
        w && w!=='Not set'
          ? navigator.clipboard.writeText(w).then(_=>alert('Copied'))
          : alert('No wallet to copy');
      };
      document.getElementById('btnSubmitCrypto').onclick = ()=>{
        const email = document.getElementById('emailCR').value.trim();
        const type  = document.getElementById('cryptoType').value;
        const proof = document.getElementById('proofCR').files[0];
        if(!email||!email.includes('@')) return alert('Enter valid email');
        if(!type) return alert('Select crypto');
        if(!proof) return alert('Upload proof image');
        if(proof.size>5*1024*1024) return alert('Max 5 MB');
        // prevent dup
        let recs = JSON.parse(localStorage.getItem('paymentRecords')||'[]');
        if(recs.some(r=>r.email===email&&r.status!=='expired'))
          return alert('Already submitted');
        let reader = new FileReader();
        reader.onload = e=>{
          recs.push({
            name: email.split('@')[0],
            email, username: email.split('@')[0],
            amount: plans[pkg]||0,
            method: type,
            walletType: type,
            proof: e.target.result,
            status: 'pending',
            submittedAt: new Date().toISOString()
          });
          localStorage.setItem('paymentRecords', JSON.stringify(recs));
          alert('Submitted! Await approval.');
          window.location.href = 'index.html';
        };
        reader.readAsDataURL(proof);
      };
    })();
  </script>
</body>
</html>
