<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VIP Dashboard â€“ CBE Global FX</title>

  <!-- Redirect if not logged in -->
  <script>
    if (sessionStorage.getItem('cbeLoggedIn') !== 'true') {
      window.location.replace('login.html');
    }
  </script>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>

  <!-- Supabase & TradingView -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="https://s3.tradingview.com/tv.js"></script>

  <style>
  /* RESET */
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { width:100%; height:100%; font-family:'Poppins',sans-serif; overflow-x:hidden; }
  a { text-decoration:none; color:inherit; }

  /* THEME VARIABLES */
  :root {
    --bg: #000;
    --panel-bg: rgba(0,0,0,0.85);
    --gold: #ffd700;
    --muted: #555;
    --text: #eee;
    --card-bg: rgba(20,20,20,0.85);
    --overlay: rgba(0,0,0,0.5);
  }
  [data-theme="light"] {
    --bg: #f4f6fc;
    --panel-bg: rgba(255,255,255,0.85);
    --text: #222;
    --muted: #888;
    --card-bg: rgba(255,255,255,0.85);
    --overlay: rgba(255,255,255,0.5);
  }

  body {
    display:flex; background:var(--bg); color:var(--text);
    visibility:hidden;
  }

  /* STAR BACKGROUND */
  body::before {
    content:""; position:fixed; top:0; left:0; width:100%; height:100%;
    background:url('https://raw.githubusercontent.com/joshbuchea/atom/master/svgs/stars.svg') center/cover no-repeat;
    opacity:0.1; pointer-events:none; z-index:-1;
  }

  /* SIDEBAR */
  #sidebar {
    width:240px; background:var(--panel-bg); display:flex; flex-direction:column;
    align-items:center; padding:2rem 1rem;
  }
  #sidebar .logo { cursor:pointer; margin-bottom:2rem; }
  #sidebar .logo img { width:140px; }
  #sidebar nav { width:100%; }
  #sidebar nav a {
    display:flex; align-items:center; padding:.75rem 1rem; margin:.3rem 0;
    border-radius:6px; transition:background .2s; color:var(--text);
  }
  #sidebar nav a:hover, #sidebar nav a.active { background:var(--overlay); }
  #sidebar nav a i { margin-right:.8rem; color:var(--gold); }

  /* MAIN */
  #main { flex:1; display:flex; flex-direction:column; overflow-y:auto; }

  /* TOPBAR */
  #topbar {
    display:flex; justify-content:space-between; align-items:center;
    padding:1rem 2rem; background:var(--panel-bg);
    box-shadow:0 2px 8px var(--overlay); position:sticky; top:0; z-index:10;
  }
  #topbar .greeting { font-size:1.25rem; }
  #topbar .actions { display:flex; align-items:center; }
  .btn-icon, #theme-toggle {
    background:none; border:none; color:var(--text);
    font-size:1.5rem; margin-left:1rem; position:relative; cursor:pointer;
  }
  #notif-badge {
    position:absolute; top:4px; right:4px;
    background:var(--gold); color:#000;
    font-size:.65rem; font-weight:700; padding:2px 5px; border-radius:50%;
  }

  /* STATS */
  #stats {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:1rem; padding:1.5rem 2rem; background:var(--bg);
  }
  .stat-card {
    background:var(--card-bg); padding:1.2rem; border-radius:8px;
    box-shadow:0 4px 20px var(--overlay);
  }
  .stat-card h3 { color:var(--muted); margin-bottom:.4rem; }
  .stat-card p { font-size:1.8rem; font-weight:600; color:var(--gold); }

  /* QUICK ACCESS */
  section { padding:1.5rem 2rem; }
  section h2 { color:var(--gold); margin-bottom:1rem; font-size:1.4rem; }
  .cards-grid {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:1rem;
  }
  .card {
    background:var(--card-bg); border-radius:8px; overflow:hidden;
    box-shadow:0 4px 20px var(--overlay);
  }
  .card-header {
    background:var(--gold); color:#000; padding:1rem; font-weight:600;
  }
  .card-body { padding:1rem; }
  .card-body p { margin-bottom:1rem; color:var(--text); }
  .card-body a.btn {
    display:inline-block; padding:.5rem 1rem; background:var(--gold);
    color:#000; border-radius:4px; font-weight:600; transition:opacity .2s;
  }
  .card-body a.btn:hover { opacity:.8; }

  /* FULLSCREEN CHART */
  #gold-chart { margin-top:2rem; }
  #gold-chart h2 { text-align:center; color:var(--gold); padding-top:1rem; }
  #tradingview_chart { width:100%; height:100vh; }

  /* FOOTER */
  footer { text-align:center; padding:1rem; background:var(--panel-bg); color:var(--muted); }

  /* RESPONSIVE */
  @media(max-width:768px){
    #sidebar{display:none;}
    body{flex-direction:column;}
    #topbar,#stats,section{padding:1rem;}
  }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="logo" onclick="window.location='index.html'">
      <img src="CBE_logo.png" alt="CBE Global FX Logo"/>
    </div>
    <nav>
      <a href="vip-dashboard.html" class="active"><i class="fas fa-chart-pie"></i> Dashboard</a>
      <a href="signals.html"><i class="fas fa-bolt"></i> Signals</a>
      <a href="CBE_trade_insights_vip.html"><i class="fas fa-lightbulb"></i> Insights</a>
      <a href="CBE_trade_history_vip.html"><i class="fas fa-history"></i> History</a>
      <a href="mailto:apexincomeoptions@gmail.com"><i class="fas fa-headset"></i> Support</a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <div id="main">
    <!-- TOPBAR -->
    <div id="topbar">
      <div class="greeting">Welcome back, <strong id="userName">Trader</strong>!</div>
      <div class="actions">
        <button id="theme-toggle" aria-label="Toggle theme">ðŸŒž</button>
        <button id="notif-button" class="btn-icon" aria-label="Notifications">
          <i class="fas fa-bell"></i><span id="notif-badge">0</span>
        </button>
      </div>
    </div>

    <!-- STATS -->
    <div id="stats">
      <div class="stat-card">
        <h3>Today's Signals</h3><p id="count-signals">0</p>
      </div>
      <div class="stat-card">
        <h3>Insights Posted</h3><p id="count-insights">0</p>
      </div>
      <div class="stat-card">
        <h3>History Entries</h3><p id="count-history">0</p>
      </div>
    </div>

    <!-- QUICK ACCESS -->
    <section>
      <h2>Quick Access</h2>
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">View Signals</div>
          <div class="card-body">
            <p>Access todayâ€™s curated Forex signals.</p>
            <a href="signals.html" class="btn">Go to Signals</a>
          </div>
        </div>
        <div class="card">
          <div class="card-header">Trade Insights</div>
          <div class="card-body">
            <p>Browse expert analysis & screenshots.</p>
            <a href="CBE_trade_insights_vip.html" class="btn">View Insights</a>
          </div>
        </div>
        <div class="card">
          <div class="card-header">Trade History</div>
          <div class="card-body">
            <p>Review every logged trade this year.</p>
            <a href="CBE_trade_history_vip.html" class="btn">View History</a>
          </div>
        </div>
        <div class="card">
          <div class="card-header">Live Chart</div>
          <div class="card-body">
            <p>Scroll down for full-screen XAU/USD chart.</p>
            <a href="#gold-chart" class="btn">Go to Chart</a>
          </div>
        </div>
      </div>
    </section>

    <!-- FULLSCREEN CHART -->
    <section id="gold-chart">
      <h2>Gold (XAU/USD) Real-Time Chart</h2>
      <div id="tradingview_chart"></div>
    </section>

    <footer>Â© 2025 CBE Global FX â€¢ All rights reserved.</footer>
  </div>

  <!-- Smartsupp Live Chat -->
  <script type="text/javascript">
    var _smartsupp = _smartsupp || {};
    _smartsupp.key = '018a8bbd868518221e725341a7b2601231ec7ce8';
    window.smartsupp||(function(d) {
      var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
      s=d.getElementsByTagName('script')[0];c=d.createElement('script');
      c.type='text/javascript';c.charset='utf-8';c.async=true;
      c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
    })(document);
  </script>

  <script>
    // Show page & set user name
    document.body.style.visibility='visible';
    document.getElementById('userName').textContent = sessionStorage.getItem('cbeUserName') || 'Trader';

    // Theme toggle
    const html = document.documentElement,
          tbtn = document.getElementById('theme-toggle');
    let theme = localStorage.getItem('theme')||'dark';
    html.setAttribute('data-theme',theme);
    tbtn.textContent = theme==='dark'?'ðŸŒž':'ðŸŒœ';
    tbtn.onclick = ()=>{
      theme = theme==='dark'?'light':'dark';
      html.setAttribute('data-theme',theme);
      localStorage.setItem('theme',theme);
      tbtn.textContent = theme==='dark'?'ðŸŒž':'ðŸŒœ';
    };

    // Initialize Supabase
    const SUPA_URL = 'https://dapwpgvnfjcfqqhrpxla.supabase.co';
    const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhcHdwZ3ZuZmpjZnFxaHJweGxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDA4ODgsImV4cCI6MjA2MjYxNjg4OH0.ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ';
    const sb = supabase.createClient(SUPA_URL, SUPA_KEY);

    // TradingView full-screen chart
    new TradingView.widget({
      container_id: "tradingview_chart",
      width: "100%", height: "100vh",
      symbol: "OANDA:XAUUSD", interval: "60",
      theme: "dark", style: "1", locale: "en",
      toolbar_bg: "#000", hide_side_toolbar: false,
      enable_publishing: false, allow_symbol_change: true
    });

    // Notifications & Stats
    const notifBtn = document.getElementById('notif-button'),
          notifBadge = document.getElementById('notif-badge'),
          notifList = document.createElement('ul');
    notifList.className='notif-dropdown';
    document.body.appendChild(notifList);

    let counts = { signals:0, insights:0, history:0 },
        notifs = [];

    function updateBadge() {
      const total = counts.signals + counts.insights + counts.history;
      notifBadge.textContent = total;
    }
    function addNotif(type, text) {
      notifs.unshift(`${type}: ${text}`);
      if (notifs.length > 10) notifs.pop();
      renderNotifs(); updateBadge();
    }
    function renderNotifs() {
      notifList.innerHTML = notifs.length
        ? notifs.map(n=>`<li class="notif-item">${n}</li>`).join('')
        : `<li class="notif-item">No new notifications</li>`;
    }
    notifBtn.addEventListener('click', e=>{
      e.stopPropagation();
      notifList.style.display = notifList.style.display==='block'?'none':'block';
    });
    document.addEventListener('click', ()=>{ notifList.style.display='none'; });

    // Realtime listeners
    sb.from('signals').on('INSERT', p=>{
      counts.signals++;
      document.getElementById('count-signals').textContent = counts.signals;
      addNotif('Signal', new Date(p.new.created_at).toLocaleTimeString());
    }).subscribe();

    sb.from('trade_insights').on('INSERT', p=>{
      counts.insights++;
      document.getElementById('count-insights').textContent = counts.insights;
      addNotif('Insight','New insight posted');
    }).subscribe();

    sb.from('trade_history').on('INSERT', p=>{
      counts.history++;
      document.getElementById('count-history').textContent = counts.history;
      addNotif('History', new Date(p.new.timestamp).toLocaleDateString());
    }).subscribe();

    // Initialize counts
    (async()=>{
      let { count:cs } = await sb.from('signals').select('*', { count:'exact' });
      let { count:ci } = await sb.from('trade_insights').select('*', { count:'exact' });
      let { count:ch } = await sb.from('trade_history').select('*', { count:'exact' });
      counts.signals=cs; counts.insights=ci; counts.history=ch;
      document.getElementById('count-signals').textContent=cs;
      document.getElementById('count-insights').textContent=ci;
      document.getElementById('count-history').textContent=ch;
      updateBadge(); renderNotifs();
    })();
  </script>
</body>
</html>
