<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VIP Gold Dashboard â€“ CBE Global FX</title>

  <!-- Bootstrap, Icons, Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- Supabase and TradingView -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="https://s3.tradingview.com/tv.js"></script>

  <style>
    :root {
      --bg: #1a1a1a;
      --panel: rgba(30, 30, 30, 0.95);
      --gold: #d4af37;
      --text: #e0e0e0;
    }
    body {
      background: linear-gradient(135deg, var(--bg), #222);
      color: var(--text);
      font-family: 'Roboto', sans-serif;
    }
    .bg-panel {
      background: var(--panel);
      border-radius: 10px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }
    .text-gold { color: var(--gold); }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
    }
    #tv_chart { height: 600px; width: 100%; }
    #news-feed a { color: var(--gold); text-decoration: none; }
    #news-feed a:hover { text-decoration: underline; }
    .fade-in { animation: fadeIn 0.8s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="bg-panel p-3 sticky-top fade-in">
    <h5 class="text-gold">Welcome, Trader!</h5>
  </header>

  <!-- Main Content -->
  <div class="container-fluid p-4">
    <!-- Real-Time Gold Price Ticker -->
    <div class="card bg-panel p-4 mb-4 fade-in">
      <h2 class="text-gold mb-3">Live Gold Price</h2>
      <div id="price-ticker" style="height: 100px;"></div>
    </div>

    <!-- Latest Signal -->
    <div class="card bg-panel p-4 mb-4 fade-in">
      <h2 class="text-gold mb-3">Latest Signal</h2>
      <div id="signal-body" class="text-center">Loading...</div>
    </div>

    <!-- XAUUSD Chart -->
    <div class="card bg-panel p-4 mb-4 fade-in">
      <h2 class="text-gold mb-3">XAUUSD Chart (Daily)</h2>
      <div id="tv_chart"></div>
    </div>

    <!-- Gold News -->
    <div class="card bg-panel p-4 mb-4 fade-in">
      <h2 class="text-gold mb-3">Gold News</h2>
      <div id="news-feed">Loading news...</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Supabase Setup
    const SUPA_URL = 'https://dapwpgvnfjcfqqhrpxla.supabase.co';
    const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhcHdwZ3ZuZmpjZnFxaHJweGxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDA4ODgsImV4cCI6MjA2MjYxNjg4OH0.ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ';
    const supabase = window.supabase.createClient(SUPA_URL, SUPA_KEY);

    // TradingView Widgets
    function loadWidgets() {
      // Price Ticker
      new TradingView.MiniSymbolOverviewWidget({
        "container_id": "price-ticker",
        "width": "100%",
        "height": 100,
        "symbol": "OANDA:XAUUSD",
        "colorTheme": "dark",
        "locale": "en"
      });

      // XAUUSD Chart with RSI
      new TradingView.widget({
        "width": "100%",
        "height": 600,
        "symbol": "OANDA:XAUUSD",
        "interval": "D", // Daily view
        "theme": "dark",
        "locale": "en",
        "studies": ["RSI@tv-basicstudies"], // RSI Indicator
        "container_id": "tv_chart"
      });
    }
    loadWidgets();

    // Fetch Latest Signal
    async function fetchLatestSignal() {
      const { data, error } = await supabase
        .from('signals')
        .select('*')
        .order('timestamp', { ascending: false })
        .limit(1);
      if (error) {
        document.getElementById('signal-body').innerHTML = 'Error loading signal';
        return;
      }
      const signal = data[0];
      document.getElementById('signal-body').innerHTML = signal ? `
        <p>Asset: ${signal.asset}</p>
        <p>Direction: ${signal.direction}</p>
        <p>Entry: ${signal.entry}</p>
      ` : 'No signals found';
    }
    fetchLatestSignal();

    // Real-Time Signal Updates
    supabase.channel('signals').on('INSERT', () => {
      fetchLatestSignal();
    }).subscribe();

    // Fetch Gold News from Kitco
    async function loadNews() {
      const rssUrl = 'https://www.kitco.com/rss/gold.xml';
      const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        if (data.status === 'ok') {
          const newsItems = data.items.slice(0, 5).map(item => `
            <p><a href="${item.link}" target="_blank">${item.title}</a> - ${new Date(item.pubDate).toLocaleDateString()}</p>
          `).join('');
          document.getElementById('news-feed').innerHTML = newsItems || 'No news found';
        }
      } catch (error) {
        document.getElementById('news-feed').innerHTML = 'Error loading news';
      }
    }
    loadNews();
  </script>
</body>
</html>
