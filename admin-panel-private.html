<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel – CBE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />
  <style>
    /* [Your existing CSS unchanged] */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    html, body { height: 100%; background: #0b0b0b; color: #f5f5f5; }
    video#bg-video { position: fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-2; }
    #overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:-1; }
    #toggleSidebar { position:fixed; top:15px; left:15px; background:gold; border:none; color:#000; font-size:1.5rem; border-radius:5px; width:36px; height:36px; cursor:pointer; z-index:1001; }
    .container { display:flex; height:100%; }
    .sidebar { width:220px; background:#111; padding-top:70px; position:fixed; height:100%; border-right:1px solid #333; transition:transform .3s ease; z-index:1000; }
    .sidebar a { display:block; padding:12px 20px; color:#ccc; text-decoration:none; border-left:4px solid transparent; }
    .sidebar a:hover, .sidebar a.active { color:gold; background:#1c1c1c; border-left-color:gold; }
    .content { margin-left:220px; padding:20px 30px; flex:1; overflow-y:auto; transition:margin-left .3s ease; }
    body.collapsed-sidebar .sidebar { transform:translateX(-100%); }
    body.collapsed-sidebar .content { margin-left:0; }
    h2 { color:gold; margin-bottom:20px; }
    table { width:100%; border-collapse:collapse; margin-bottom:30px; }
    th, td { padding:10px; border-bottom:1px solid #333; }
    th { background:#222; color:#ccc; }
    tr:hover { background:#1e1e1e; }
    .btn { background:gold; border:none; color:#000; padding:6px 12px; border-radius:4px; font-weight:bold; cursor:pointer; }
    .btn:hover { background:#e6c200; }
    .hidden { display:none; }
    form { background:#1c1c1c; padding:20px; border-radius:10px; margin-bottom:30px; }
    .form-group { margin-bottom:16px; }
    .form-group label { display:block; margin-bottom:6px; color:#ccc; }
    .form-group input { width:100%; padding:10px; background:#111; border:1px solid #333; color:#f5f5f5; border-radius:6px; }
    .download-btn { margin-bottom:10px; background:#0b0b0b; border:1px solid gold; color:gold; padding:8px 12px; border-radius:4px; cursor:pointer; }
    .download-btn:hover { background:gold; color:#000; }
  </style>
</head>
<body>
  <script>
    if (sessionStorage.getItem('adminAuthenticated') !== 'true') {
      window.location.href = 'admin-login.html';
    }
  </script>

  <video id="bg-video" autoplay muted loop playsinline>
    <source src="star-video.MP4" type="video/mp4" />
  </video>
  <div id="overlay"></div>

  <button id="toggleSidebar">⋮</button>

  <div class="container">
    <nav class="sidebar">
      <a href="#" class="active" data-section="dashboard">Dashboard</a>
      <a href="#" data-section="payments">Payments</a>
      <a href="#" data-section="users">Users</a>
      <a href="#" data-section="trades">Trades</a>
      <a href="#" data-section="signals">Signals</a>
      <a href="#" data-section="broadcasts">Broadcasts</a>
      <a href="#" data-section="messages">Messages</a>
      <a href="#" data-section="settings">Settings</a>
      <a href="#" data-section="logs">Logs</a>
      <a href="index.html" target="_blank">Visit Site</a>
      <a href="admin-login.html" class="btn">Logout</a>
    </nav>

    <div class="content">

      <!-- Dashboard -->
      <section id="dashboard">
        <h2>Welcome Admin</h2>
        <p>Use the menu to manage your site.</p>
      </section>

      <!-- Payments -->
      <section id="payments" class="hidden">
        <h2>Payment Records</h2>
        <button class="download-btn" onclick="downloadPayments()">Download CSV</button>
        <table>
          <thead>
            <tr>
              <th>Name</th><th>Email</th><th>Username</th><th>Amount</th>
              <th>Method</th><th>Wallet</th><th>Proof</th><th>Status</th><th>Action</th>
            </tr>
          </thead>
          <tbody id="paymentTableBody"></tbody>
        </table>
      </section>

      <!-- Signal Publisher -->
      <section id="signals" class="hidden">
        <h2>Publish Signal</h2>
        <form id="signalForm">
          <div class="form-group"><label>Currency Pair</label><input type="text" id="pair" required></div>
          <div class="form-group"><label>Type (BUY/SELL)</label><input type="text" id="type" required></div>
          <div class="form-group"><label>Entry Price</label><input type="text" id="entry" required></div>
          <div class="form-group"><label>Take Profit</label><input type="text" id="tp" required></div>
          <div class="form-group"><label>Stop Loss</label><input type="text" id="sl" required></div>
          <div class="form-group"><label>Time</label><input type="text" id="time" placeholder="e.g. 10:30 AM" required></div>
          <div class="form-group"><label>Note</label><input type="text" id="note" placeholder="Optional note"></div>
          <button type="submit" class="btn">Publish</button>
        </form>
        <h3>Published Signals</h3>
        <table>
          <thead><tr><th>Date</th><th>Pair</th><th>Type</th><th>TP</th><th>SL</th><th>Action</th></tr></thead>
          <tbody id="signalList"></tbody>
        </table>
      </section>

      <!-- Settings -->
      <section id="settings" class="hidden">
        <h2>Payment Wallet Settings</h2>
        <form id="settingsForm">
          <div class="form-group">
            <label for="btc">Bitcoin Wallet Address</label>
            <input type="text" id="btc" placeholder="e.g. bc1q…" />
          </div>
          <div class="form-group">
            <label for="eth">Ethereum Wallet Address</label>
            <input type="text" id="eth" placeholder="e.g. 0x…" />
          </div>
          <div class="form-group">
            <label for="usdt">USDT Wallet Address</label>
            <input type="text" id="usdt" placeholder="e.g. T…" />
          </div>
          <button type="submit" class="btn">Save Wallet Addresses</button>
        </form>
      </section>

      <!-- Logs -->
      <section id="logs" class="hidden">
        <h2>Admin Logs</h2>
        <ul id="log-list" style="color:#ccc; line-height:1.6;"></ul>
      </section>

    </div> <!-- /.content -->
  </div> <!-- /.container -->
  <script>
    // Sidebar toggle & navigation
    document.getElementById("toggleSidebar").addEventListener("click", () => {
      document.body.classList.toggle("collapsed-sidebar");
    });
    document.querySelectorAll(".sidebar a[data-section]").forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        document.querySelectorAll(".sidebar a").forEach(a => a.classList.remove("active"));
        link.classList.add("active");
        const sec = link.getAttribute("data-section");
        document.querySelectorAll(".content section").forEach(s => s.classList.add("hidden"));
        document.getElementById(sec).classList.remove("hidden");

        if (sec === "payments") loadPayments();
        if (sec === "signals") renderSignals();
        if (sec === "logs") renderLogs();
      });
    });

    // --- SIGNAL PUBLISHER ---
    const signalForm = document.getElementById("signalForm");
    const signalList = document.getElementById("signalList");
    const signalStore = JSON.parse(localStorage.getItem("signals") || "[]");
    function renderSignals() {
      signalList.innerHTML = "";
      signalStore.forEach((s,i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.date}</td><td>${s.pair}</td><td>${s.type}</td>
          <td>${s.tp}</td><td>${s.sl}</td>
          <td><button class="btn" onclick="deleteSignal(${i})">Delete</button></td>`;
        signalList.appendChild(tr);
      });
    }
    signalForm.addEventListener("submit", e => {
      e.preventDefault();
      const date = new Date().toLocaleDateString();
      const pair = document.getElementById("pair").value;
      const type = document.getElementById("type").value.toUpperCase();
      const entry = document.getElementById("entry").value;
      const tp = document.getElementById("tp").value;
      const sl = document.getElementById("sl").value;
      const time = document.getElementById("time").value;
      const note = document.getElementById("note").value;
      signalStore.unshift({ date, pair, type, entry, tp, sl, time, note });
      localStorage.setItem("signals", JSON.stringify(signalStore));
      renderSignals();
      signalForm.reset();
      alert("Signal published.");
    });
    function deleteSignal(i) {
      if (confirm("Delete this signal?")) {
        signalStore.splice(i,1);
        localStorage.setItem("signals", JSON.stringify(signalStore));
        renderSignals();
      }
    }

    // --- PAYMENT RECORDS ---
    function loadPayments() {
      const tbody = document.getElementById("paymentTableBody");
      const records = JSON.parse(localStorage.getItem("paymentRecords") || "[]");
      tbody.innerHTML = "";
      records.forEach((r,i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.name}</td><td>${r.email}</td><td>${r.username}</td>
          <td>$${r.amount}</td><td>${r.method}</td><td>${r.walletType}</td>
          <td><a href="${r.proof}" target="_blank">View</a></td>
          <td>${r.status||"Pending"}</td>
          <td>${r.status==="Approved"?"✓":`<button class="btn" onclick="approvePayment(${i})">Approve</button>`}</td>`;
        tbody.appendChild(tr);
      });
    }
    function approvePayment(i) {
      const recs = JSON.parse(localStorage.getItem("paymentRecords") || "[]");
      const rec = recs[i];
      rec.status = "Approved";
      localStorage.setItem("paymentRecords", JSON.stringify(recs));
      // Grant VIP
      const users = JSON.parse(localStorage.getItem("users")||"[]");
      const u = users.find(u=>u.email===rec.email);
      if(u) u.vip=true;
      localStorage.setItem("users",JSON.stringify(users));
      addLog(`Approved VIP for ${rec.username}`);
      alert("VIP access granted.");
      loadPayments();
    }
    function downloadPayments() {
      const data = JSON.parse(localStorage.getItem("paymentRecords")||"[]");
      if(!data.length) return alert("No records.");
      const rows=[["Name","Email","Username","Amount","Method","Wallet","Proof","Status"]];
      data.forEach(d=>rows.push([d.name,d.email,d.username,d.amount,d.method,d.walletType,d.proof,d.status||"Pending"]));
      const csv="data:text/csv;charset=utf-8,"+rows.map(r=>r.join(",")).join("\n");
      const link=document.createElement("a");
      link.href=encodeURI(csv);
      link.download="payment_records.csv";
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // --- SETTINGS LOGIC ---
    const settingsForm = document.getElementById('settingsForm');
    const btcInput = document.getElementById('btc');
    const ethInput = document.getElementById('eth');
    const usdtInput = document.getElementById('usdt');
    function loadSettings(){
      const s = JSON.parse(localStorage.getItem('paymentSettings') || '{}');
      btcInput.value  = s.btc  || '';
      ethInput.value  = s.eth  || '';
      usdtInput.value = s.usdt || '';
    }
    settingsForm.addEventListener('submit', e => {
      e.preventDefault();
      const newS = { btc:btcInput.value.trim(), eth:ethInput.value.trim(), usdt:usdtInput.value.trim() };
      localStorage.setItem('paymentSettings', JSON.stringify(newS));
      addLog('Updated wallet settings');
      alert('Wallet addresses saved!');
    });

    // --- LOGS ---
    function renderLogs(){
      const ul = document.getElementById('log-list');
      const logs = JSON.parse(localStorage.getItem('adminLogs')||'[]');
      ul.innerHTML='';
      logs.forEach(entry => {
        const li=document.createElement('li');
        li.textContent=`[${new Date(entry.time||Date.now()).toLocaleString()}] ${entry}`;
        ul.appendChild(li);
      });
    }
    function addLog(action){
      const logs = JSON.parse(localStorage.getItem('adminLogs')||'[]');
      logs.unshift({ time:Date.now(), action });
      localStorage.setItem('adminLogs', JSON.stringify(logs));
    }

    // Initialize on load
    window.addEventListener('DOMContentLoaded', () => {
      loadPayments();
      renderSignals();
      loadSettings();
      renderLogs();
    });
  </script>
</body>
</html>
