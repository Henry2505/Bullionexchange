<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CBE Admin Panel</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- DataTables -->
  <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Sortable.js -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    /* Video BG & Overlay */
    video#bg {position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-2;}
    .overlay {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:-1;}
    /* Theme vars */
    :root {--bg:#121212;--fg:#f5f5f5;--glass:rgba(255,255,255,0.05);}
    [data-theme="light"]{--bg:#f0f0f0;--fg:#333;--glass:rgba(255,255,255,0.6);}
    body{margin:0;padding:0;overflow-x:hidden;font-family:Poppins,sans-serif;background:var(--bg);color:var(--fg);}
    a{color:inherit;text-decoration:none;}
    .glass{background:var(--glass);backdrop-filter:blur(12px);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.4);opacity:0;animation:fadeIn 0.8s forwards;}
    @keyframes fadeIn {to {opacity:1;}}
    #sidebar{width:250px;background:rgba(0,0,0,0.3);transition:.3s;}
    #sidebar.collapsed{margin-left:-250px;}
    #sidebar .nav-link{color:#ddd;}
    #sidebar .nav-link.active,#sidebar .nav-link:hover{background:rgba(255,255,255,0.1);color:#fff;}
    #content{flex:1;padding:1.5rem;}
    #toggle-btn{cursor:pointer;font-size:1.5rem;}
    .card-stat{cursor:grab;color:#fff;border:none;}
    .form-control,.form-select{background:rgba(255,255,255,0.1);border:none;color:#fff;}
    .form-control:focus,.form-select:focus{background:rgba(255,255,255,0.15);box-shadow:none;}
    .btn-primary{background:#ffd700;color:#000;border:none;}
    .btn-success{background:#1cc88a;border:none;}
    .btn-outline-secondary{color:#fff;border-color:rgba(255,255,255,0.4);}
    .btn-outline-secondary:hover{background:rgba(255,255,255,0.1);}
    h4{color:#ffd700;}
    #toast-container{position:fixed;bottom:1rem;right:1rem;z-index:1050;}
    /* DataTables overrides */
    table.dataTable thead th {background:rgba(255,255,255,0.1);}
  </style>
</head>
<body data-theme="dark">

  <!-- Background & Toasts -->
  <video id="bg" autoplay muted loop><source src="star-video.MP4" type="video/mp4"/></video>
  <div class="overlay"></div>
  <div id="toast-container"></div>

  <div class="d-flex glass" style="min-height:100vh;">
    <!-- Sidebar -->
    <nav id="sidebar" class="d-flex flex-column p-3">
      <h4 class="text-center">CBE Admin</h4>
      <ul class="nav nav-pills flex-column mb-auto mt-4" id="menu">
        <li><a class="nav-link active" data-section="dashboard" href="#">Dashboard</a></li>
        <li><a class="nav-link" data-section="users" href="#">Users</a></li>
        <li><a class="nav-link" data-section="payments" href="#">Payments</a></li>
        <li><a class="nav-link" data-section="messages" href="#">Messages</a></li>
        <li><a class="nav-link" data-section="settings-payment" href="#">Payment Settings</a></li>
        <li><a class="nav-link" data-section="trade-history" href="#">Trade History</a></li>
        <li><a class="nav-link" data-section="trade-insights" href="#">Trade Insights</a></li>
        <li><a class="nav-link" data-section="signals" href="#">Signals</a></li>
        <li class="mt-auto"><a class="nav-link text-danger" href="#">Logout</a></li>
      </ul>
    </nav>

    <!-- Main Content -->
    <div id="content" class="d-flex flex-column">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <span id="toggle-btn">&#8942;</span>
          <button id="theme-toggle" class="btn btn-sm btn-outline-secondary ms-2">Light Mode</button>
        </div>
        <div class="d-flex align-items-baseline">
          <h2 id="section-title">Dashboard</h2>
          <small class="text-muted ms-3" id="current-datetime"></small>
        </div>
      </div>

      <div id="sections">
        <!-- Dashboard -->
        <div class="section p-4 mb-4 glass" data-section="dashboard">
          <div id="stats-container" class="row g-3 mb-4">
            <!-- existing stat cards -->
          </div>
          <div class="row g-4">
            <div class="col-md-6 glass p-3">
              <canvas id="chart-pnl"></canvas>
            </div>
            <div class="col-md-6 glass p-3">
              <canvas id="chart-winrate"></canvas>
            </div>
          </div>
          <!-- New Data Visualization -->
          <div class="row g-4 mt-4">
            <div class="col-md-6 glass p-3">
              <h4>User Status Distribution</h4>
              <canvas id="chart-user-status"></canvas>
            </div>
            <div class="col-md-6 glass p-3">
              <h4>Payment Trends</h4>
              <canvas id="chart-payments-trend"></canvas>
            </div>
          </div>
        </div>

        <!-- Users -->
        <div class="section d-none p-4 mb-4 glass" data-section="users">
          <h4>Users</h4>
          <table id="users-table" class="table table-striped table-bordered text-white" style="width:100%">
            <thead>
              <tr>
                <th>#</th><th>Name</th><th>Email</th><th>Registration Date</th><th>Status</th><th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Payments -->
        <div class="section d-none p-4 mb-4 glass" data-section="payments">
          <h4>Payments</h4>
          <table id="payments-table" class="table table-striped table-bordered text-white" style="width:100%">
            <thead>
              <tr>
                <th>#</th><th>User</th><th>Amount</th><th>Payment Method</th><th>Date</th><th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Messages -->
        <div class="section d-none p-4 mb-4 glass" data-section="messages">
          <h4>Messages</h4>
          <table id="messages-table" class="table table-striped table-bordered text-white" style="width:100%">
            <thead>
              <tr>
                <th>#</th><th>From</th><th>Message</th><th>Date</th><th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Payment Settings -->
        <!-- (unchanged) -->

        <!-- Trade History -->
        <div class="section d-none p-4 mb-4 glass" data-section="trade-history">
          <h4>Trade History</h4>

          <!-- Month Filter / Search / Export -->
          <div class="row g-2 mb-3 align-items-end">
            <!-- existing filters -->
          </div>

          <!-- Upload Form -->
          <!-- existing form -->

          <!-- History Table -->
          <table id="history-table" class="table table-striped table-bordered text-white" style="width:100%">
            <thead>
              <tr>
                <th>Date</th><th>Asset</th><th>Trade Type</th><th>Notes</th><th>Screenshot</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Trade Insights -->
        <div class="section d-none p-4 mb-4 glass" data-section="trade-insights">
          <h4>Trade Insights</h4>
          <!-- existing insights form and content -->
        </div>

        <!-- Signals -->
        <!-- (unchanged) -->
      </div>
    </div>
  </div>

  <!-- Reply Modal -->
  <!-- (unchanged) -->

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
  <script>
    // ===== Dummy Data =====
    const dummyData = {
      users: [
        { id:1,name:'Alice',email:'alice@example.com',registered:'2025-01-15',status:'Active' },
        { id:2,name:'Bob',email:'bob@example.com',registered:'2025-03-02',status:'Pending' },
        // ... more
      ],
      payments: [
        { id:1,user:'Alice',amount:'$500',method:'Paystack',date:'2025-04-10' },
        { id:2,user:'Bob',amount:'$200',method:'Crypto',date:'2025-05-01' },
        // ... more
      ],
      messages: [
        { id:1,from:'Charlie',text:'Need help',date:'2025-05-18' },
        // ... more
      ],
      trades: [
        { date:'2025-05-05',asset:'GOLD',type:'Long',notes:'Good entry',screenshot:'' },
        // ... more
      ],
      userStatusDist: { Active: 60, Pending: 25, Suspended: 15 },
      paymentTrends: [
        { week:'W1',amount:1200 },
        { week:'W2',amount:1500 },
        { week:'W3',amount:900 },
        { week:'W4',amount:1700 },
      ]
    };

    // ===== Initialization =====
    document.addEventListener('DOMContentLoaded', ()=> {
      // Current date & time
      const dtEl = document.getElementById('current-datetime');
      const updateTime = ()=> dtEl.textContent = new Date().toLocaleString();
      updateTime(); setInterval(updateTime,60000);

      // Theme toggle
      const themeBtn=document.getElementById('theme-toggle');
      themeBtn.onclick=()=>{
        const next=document.body.getAttribute('data-theme')==='dark'?'light':'dark';
        document.body.setAttribute('data-theme',next);
        themeBtn.textContent= next==='dark'?'Light Mode':'Dark Mode';
      };

      // Sidebar nav
      document.getElementById('toggle-btn').onclick=()=>document.getElementById('sidebar').classList.toggle('collapsed');
      document.querySelectorAll('#menu .nav-link').forEach(link=>{
        link.onclick=e=>{
          e.preventDefault();
          document.querySelectorAll('#menu .nav-link').forEach(l=>l.classList.remove('active'));
          link.classList.add('active');
          document.getElementById('section-title').textContent=link.textContent;
          document.querySelectorAll('.section').forEach(sec=>
            sec.classList.toggle('d-none',sec.dataset.section!==link.dataset.section)
          );
        };
      });

      // ===== DataTables Setup =====
      $('#users-table').DataTable({
        data: dummyData.users,
        columns: [
          { data:'id' },{ data:'name' },{ data:'email' },{ data:'registered' },
          { data:'status' },
          { data: null, render: (_,row)=>`<button class="btn btn-sm btn-success" onclick="alert('Approve ${row.name}')">Approve</button>` }
        ]
      });
      $('#payments-table').DataTable({
        data: dummyData.payments,
        columns: [
          { data:'id' },{ data:'user' },{ data:'amount' },{ data:'method' },{ data:'date' },
          { data: null, render: (_,row)=>`<button class="btn btn-sm btn-primary" onclick="alert('Verify ${row.id}')">Verify</button>` }
        ]
      });
      $('#messages-table').DataTable({
        data: dummyData.messages,
        columns: [
          { data:'id' },{ data:'from' },{ data:'text' },{ data:'date' },
          { data: null, render: (_,row)=>`<button class="btn btn-sm btn-success" onclick="alert('Replied to ${row.from}')">Reply</button>` }
        ]
      });
      $('#history-table').DataTable({
        data: dummyData.trades,
        columns: [
          { data:'date' },{ data:'asset' },{ data:'type' },{ data:'notes' },
          { data:'screenshot', render: src=> src?`<img src="${src}" style="height:40px;object-fit:cover"/>` : 'â€”' }
        ]
      });

      // ===== Charts =====
      async function loadDashboard(){
        // existing trade insights data fetch...
        // Pie chart: User Status
        new Chart(document.getElementById('chart-user-status'),{
          type:'pie',
          data:{
            labels:Object.keys(dummyData.userStatusDist),
            datasets:[{ data:Object.values(dummyData.userStatusDist) }]
          },
          options:{responsive:true}
        });
        // Line chart: Payment Trends
        new Chart(document.getElementById('chart-payments-trend'),{
          type:'line',
          data:{
            labels:dummyData.paymentTrends.map(d=>d.week),
            datasets:[{ data:dummyData.paymentTrends.map(d=>d.amount), tension:0.4 }]
          },
          options:{responsive:true,plugins:{legend:{display:false}}}
        });
      }
      loadDashboard();
    });
  </script>
</body>
</html>
