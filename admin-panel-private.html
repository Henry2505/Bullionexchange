<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Admin Panel – CBE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet"/>
  <style>
    /* (all your existing CSS unchanged) */
    /* … */
  </style>
</head>
<body oncontextmenu="return false;">

  <video id="bg" class="video-background" autoplay muted loop playsinline>
    <source src="star-video.mp4" type="video/mp4"/>
  </video>
  <div class="overlay"></div>

  <!-- Password Modal -->
  <div id="pwModal">…</div>

  <!-- Top Bar, Sidebar, Content Sections -->
  <div class="top-bar">…</div>
  <div class="sidebar" id="sidebar">…</div>
  <div id="main-content">
    <!-- payments, applications, users, settings, signals, broadcast, inbox, tradeInsights, tradeHistory, logs -->
    <!-- (all your sections unchanged) -->
  </div>

  <script>
    // Helpers
    function getArr(key){
      let v = localStorage.getItem(key);
      if (!v) return [];
      v = v.trim();
      if (v.charAt(0)!=='[') v='['+v+']';
      try { v=JSON.parse(v); }
      catch{ v=[]; }
      return Array.isArray(v)?v:[];
    }
    function setArr(key,a){ localStorage.setItem(key,JSON.stringify(a)); }

    // Auth & Init (unchanged)
    function checkPw(){…}
    function logout(){…}
    if(sessionStorage.adminAuth==='true')document.getElementById('pwModal').style.display='none';
    window.onload=()=>{ if(sessionStorage.adminAuth==='true') initAll(); };
    function initAll(){…}
    function showSection(id){…}
    function toggleSidebar(){…}

    // PAYMENTS
    function loadPayments(){
      const rec=getArr('paymentRecords'), c=document.getElementById('paymentContainer');
      if(!rec.length) return c.innerHTML='<p>No records.</p>';
      let html='<table><tr><th>Email</th><th>Plan</th><th>Status</th><th>Action</th></tr>';
      rec.forEach((p,i)=> html+=`<tr><td>${p.email}</td><td>${p.plan}</td><td>${p.status}</td>
        <td><button class="btn" onclick="approvePayment(${i})">Approve</button></td></tr>`);
      c.innerHTML=html+'</table>';
    }
    function approvePayment(i){
      const rec=getArr('paymentRecords'), users=getArr('users');
      rec[i].status='approved'; setArr('paymentRecords',rec);
      const em=rec[i].email.trim().toLowerCase();
      const u=users.find(u=>u.email&&u.email.trim().toLowerCase()===em);
      if(u){ u.status='approved'; setArr('users',users); }
      loadPayments(); loadUsers();
    }

    // APPLICATIONS
    function loadApplications(){
      const apps=getArr('applications'),c=document.getElementById('applicationContainer');
      if(!apps.length) return c.innerHTML='<p>No applications.</p>';
      let html='<table><tr><th>Name</th><th>Email</th><th>Status</th></tr>';
      apps.forEach(a=>html+=`<tr><td>${a.name}</td><td>${a.email}</td><td>${a.status}</td></tr>`);
      c.innerHTML=html+'</table>';
    }

    // USERS
    function loadUsers(){
      const users=getArr('users'),c=document.getElementById('userContainer');
      if(!users.length) return c.innerHTML='<p>No users.</p>';
      let html='<table><tr><th>Name</th><th>Email</th><th>Status</th><th>Actions</th></tr>';
      users.forEach((u,i)=>html+=`<tr><td>${u.name}</td><td>${u.email}</td><td>${u.status}</td>
        <td>
          <button class="btn" onclick="approveUser(${i})">Approve</button>
          <button class="btn" onclick="deactivateUser(${i})">Deactivate</button>
          <button class="btn" onclick="deleteUser(${i})">Delete</button>
        </td></tr>`);
      c.innerHTML=html+'</table>';
    }
    window.addEventListener('storage',e=>{ if(e.key==='users') loadUsers(); });
    function approveUser(i){let u=getArr('users');u[i].status='approved';setArr('users',u);log(`Approved user: ${u[i].email}`);loadUsers();}
    function deactivateUser(i){let u=getArr('users');u[i].status='inactive';setArr('users',u);log(`Deactivated user: ${u[i].email}`);loadUsers();}
    function deleteUser(i){let u=getArr('users');const r=u.splice(i,1)[0];setArr('users',u);log(`Deleted user: ${r.email}`);loadUsers();}

    // SETTINGS, SIGNALS, BROADCAST, INBOX, TRADE INSIGHTS, TRADE HISTORY, LOGS
    function loadSettings(){…}function saveSettings(){…}
    function publishSignal(){…}function sendBroadcast(){…}
    function loadInbox(){…}function uploadInsight(){…}
    function uploadHistory(){…}
    function log(m){const l=getArr('adminLogs');l.push(`${new Date().toLocaleString()}: ${m}`);setArr('adminLogs',l);}
    function loadLogs(){const l=getArr('adminLogs'),c=document.getElementById('logContainer');
      c.innerHTML = l.length?l.map(e=>`<p>${e}</p>`).join(''):'<p>No logs.</p>';}

  </script>
</body>
</html>
