<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VIP Dashboard – CBE Global FX</title>

  <!-- AUTH GUARD -->
  <script>
    if (sessionStorage.getItem('cbeLoggedIn') !== 'true') {
      window.location.replace('login.html');
    }
  </script>

  <!-- CSS + Icons + Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- Supabase + TradingView + Chart.js (if needed) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="https://s3.tradingview.com/tv.js"></script>

  <style>
    :root{--bg:#1a1a1a;--panel:rgba(30,30,30,0.95);--gold:#d4af37;--text:var(--gold)}
    [data-theme="light"]{--bg:#f0f2f5;--panel:rgba(255,255,255,0.95);--text:#b8860b}
    body{background:linear-gradient(135deg,var(--bg),#222);color:var(--text);font-family:'Roboto',sans-serif;overflow-x:hidden;margin:0}
    .bg-panel{background:var(--panel);border-radius:15px;box-shadow:0 12px 24px rgba(0,0,0,0.5)}
    .text-gold{color:var(--gold)!important}
    .btn-gold{background:var(--gold);color:#1a1a1a;border:none;border-radius:8px;padding:12px 24px;transition:transform .2s,box-shadow .2s;font-weight:500;font-size:1.1rem}
    .btn-gold:hover{transform:scale(1.05);box-shadow:0 4px 15px rgba(212,175,55,0.6)}
    @media(max-width:767px){.btn-gold{padding:8px 16px;font-size:1rem}}

    /* Full-screen chart */
    #tv_chart_4h { width:100%; height:100vh; border-radius:0; }

    /* News */
    #news-widget{background:#111;color:#fff;padding:0;border-radius:10px;overflow:hidden;height:600px}
    #news-widget ul{list-style:none;margin:0;padding:0;overflow-y:auto;height:100%}
    #news-widget li{padding:1rem;border-bottom:1px solid rgba(212,175,55,0.2)}
    #news-widget li:nth-child(odd){background:rgba(255,255,255,0.03)}
    #news-widget a{color:var(--gold);font-weight:600;text-decoration:none;font-size:1rem;word-break:break-word}
    #news-widget a:hover{text-decoration:underline}
    #news-widget .update-note{display:block;padding:.5rem 1rem;font-size:.85rem;color:#aaa;background:rgba(0,0,0,0.3)}

    /* Calendar */
    #calendar-widget{background:#111;color:#fff;padding:1rem;border-radius:10px;overflow:auto;height:600px}
    #calendar-widget table{width:100%;border-collapse:collapse}
    #calendar-widget th,#calendar-widget td{padding:.75rem;border:1px solid rgba(212,175,55,0.2);text-align:left;font-size:.9rem;word-break:break-word;white-space:normal}
    #calendar-widget th{background:rgba(212,175,55,0.1);color:var(--gold);position:sticky;top:0;z-index:2}
    #calendar-widget tbody tr:nth-child(even){background:rgba(212,175,55,0.05)}
    #calendar-widget .update-note{display:block;padding:.25rem 0;font-size:.85rem;color:#aaa;text-align:right}

    /* Nav & Header */
    .navbar{background:var(--panel);border-bottom:2px solid var(--gold)}
    .navbar .nav-link{color:var(--gold)!important;font-weight:600;font-size:1.1rem}
    #theme-toggle{font-size:1.2rem;padding:8px 12px;border:1px solid var(--gold);border-radius:5px;background:none;color:var(--text)}
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand text-gold" href="#">CBE VIP Dashboard</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navMenu"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="signals.html">Signals</a></li>
          <li class="nav-item"><a class="nav-link" href="CBE_trade_history_vip.html">History</a></li>
          <li class="nav-item"><a class="nav-link" href="CBE_trade_insights_vip.html">Insights</a></li>
          <li class="nav-item"><button id="theme-toggle" class="ms-3">Toggle Theme</button></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container-fluid p-0">
    <!-- Full-screen Gold Chart -->
    <div id="tv_chart_4h"></div>

    <!-- Gold News & Calendar side by side on desktop, stacked on mobile -->
    <div class="row g-4 m-0">
      <div class="col-lg-6 p-0">
        <div class="p-4">
          <h2 class="text-gold mb-1">Gold News <small class="update-note">Updated every minute</small></h2>
          <div id="news-widget"><ul id="news-list"></ul></div>
        </div>
      </div>
      <div class="col-lg-6 p-0">
        <div class="p-4">
          <h2 class="text-gold mb-1">Economic Calendar <small class="update-note">Updated every minute</small></h2>
          <div id="calendar-widget">
            <table>
              <thead>
                <tr><th>Date</th><th>Time</th><th>Country</th><th>Event</th><th>Forecast</th><th>Actual</th><th>Previous</th></tr>
              </thead>
              <tbody id="calendar-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center py-3 text-gold">© 2025 CBE Global FX</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Theme toggle
    const themeBtn = document.getElementById('theme-toggle');
    function setTheme(t){
      document.documentElement.setAttribute('data-theme', t);
      localStorage.setItem('theme', t);
      themeBtn.textContent = t==='dark' ? 'Light Mode' : 'Dark Mode';
    }
    themeBtn.onclick = ()=> setTheme(document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark');
    setTheme(localStorage.getItem('theme')||'dark');

    // TradingView full-screen widget
    new TradingView.widget({
      container_id:"tv_chart_4h", width:"100%", height:"100vh",
      symbol:"OANDA:XAUUSD", interval:"60", timezone:"Etc/UTC",
      theme:"dark", style:"1", locale:"en", toolbar_bg:"#1f1f1f",
      studies:["MACD@tv-basicstudies","RSI@tv-basicstudies"],
      withdateranges:true, show_popup_button:true,
      popup_width:"1000", popup_height:"650"
    });

    // Gold News (Investing.com RSS via AllOrigins)
    async function loadGoldNews(){
      const ul = document.getElementById('news-list');
      ul.innerHTML = '<li style="padding:1rem">Loading…</li>';
      try {
        const res = await fetch('https://api.allorigins.win/raw?url=https://www.investing.com/rss/news_285.rss');
        const xml = new DOMParser().parseFromString(await res.text(),'text/xml');
        const items = Array.from(xml.querySelectorAll('item')).slice(0,8);
        ul.innerHTML = '';
        items.forEach(i => {
          const link = i.querySelector('link').textContent;
          const title= i.querySelector('title').textContent;
          const li = document.createElement('li');
          li.innerHTML = `<a href="${link}" target="_blank">${title}</a>`;
          ul.appendChild(li);
        });
      } catch {
        ul.innerHTML = '<li style="color:#f55;padding:1rem">Failed to load Gold News.</li>';
      }
    }

    // Economic Calendar (FairEconomy XML)
    async function loadEconCalendar(){
      const tbody = document.getElementById('calendar-body');
      tbody.innerHTML = '<tr><td colspan="7" style="padding:1rem">Loading…</td></tr>';
      try {
        const res = await fetch('https://api.allorigins.win/raw?url=https://nfs.faireconomy.media/ff_calendar_thisweek.xml');
        const xml = new DOMParser().parseFromString(await res.text(), 'application/xml');
        const events = Array.from(xml.getElementsByTagName('event')).slice(0,15);
        tbody.innerHTML = '';
        events.forEach(ev => {
          const tr = document.createElement('tr');
          ['date','time','country','title','forecast','actual','previous'].forEach(tag => {
            const td = document.createElement('td');
            td.textContent = ev.querySelector(tag)?.textContent || '-';
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
      } catch {
        tbody.innerHTML = '<tr><td colspan="7" style="color:#f55;padding:1rem">Failed to load calendar.</td></tr>';
      }
    }

    // Auto-refresh every minute
    document.addEventListener('DOMContentLoaded',()=>{
      loadGoldNews();
      loadEconCalendar();
      setInterval(loadGoldNews,60000);
      setInterval(loadEconCalendar,60000);
    });
  </script>
</body>
</html>
