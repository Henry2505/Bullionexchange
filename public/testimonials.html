<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testimonials â€“ CBE</title>
    <meta
      name="description"
      content="Real feedback from traders whoâ€™ve grown with Chukwuemeka Bullion Exchange."
    />
    <meta name="keywords" content="CBE, testimonials, forex trading, feedback" />

    <!-- Poppins & FontAwesome -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet"/>
    <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
      /* Theme Variables */
      :root[data-theme="dark"] {
        --bg: #1a1a1a;
        --text: #e0e0e0;
        --gold: #ffd700;
        --gold-dark: #cca300;
        --glass: rgba(255, 255, 255, 0.1);
        --shadow: rgba(0, 0, 0, 0.3);
        --text-light: #b0b0b0;
        --text-muted: #888;
      }
      :root[data-theme="light"] {
        --bg: #f5f5f5;
        --text: #333;
        --gold: #cca300;
        --gold-dark: #b58900;
        --glass: rgba(0, 0, 0, 0.05);
        --shadow: rgba(0, 0, 0, 0.1);
        --text-light: #555;
        --text-muted: #666;
      }

      /* Reset & Base */
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html { scroll-behavior: smooth; }
      body {
        font-family: 'Poppins', sans-serif;
        color: var(--text);
        background: var(--bg);
        overflow-x: hidden;
        line-height: 1.6;
      }
      a { color: var(--gold); text-decoration: none; }
      a:hover { color: var(--gold-dark); text-decoration: none; }

      /* Logo & Theme Toggle */
      .logo {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
      }
      .logo img {
        height: 50px;
        transition: transform 0.3s ease;
      }
      .logo img:hover { transform: scale(1.1); }
      #theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: none;
        border: none;
        font-size: 1.8rem;
        color: var(--text);
        cursor: pointer;
        transition: transform 0.3s ease;
      }
      #theme-toggle:hover { transform: rotate(180deg); }

      /* Slide-In Animation */
      .slide-in {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.7s ease-out, transform 0.7s ease-out;
      }
      .slide-in.visible {
        opacity: 1;
        transform: translateY(0);
      }

      /* Main Wrapper */
      main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 100px 20px 60px;
      }

      /* Header Card */
      .header-card {
        background: linear-gradient(135deg, var(--glass), rgba(255, 215, 0, 0.1));
        backdrop-filter: blur(12px);
        padding: 50px 20px;
        text-align: center;
        border-radius: 15px;
        box-shadow: 0 4px 20px var(--shadow);
        margin-bottom: 40px;
      }
      .header-card h1 {
        font-family: 'Poppins', sans-serif;
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--gold);
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .header-card p {
        font-size: 1.1rem;
        color: var(--text-light);
      }

      /* Form Card */
      .form-card {
        background: var(--glass);
        backdrop-filter: blur(12px);
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 4px 20px var(--shadow);
        margin-bottom: 60px;
      }
      .form-card h2 {
        font-family: 'Poppins', sans-serif;
        font-size: 2rem;
        font-weight: 500;
        color: var(--gold);
        margin-bottom: 20px;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-light);
        font-weight: 500;
      }
      .form-group input[type="text"],
      .form-group textarea {
        width: 100%;
        padding: 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: var(--text);
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }
      .form-group input[type="text"]:focus,
      .form-group textarea:focus {
        border-color: var(--gold);
        outline: none;
      }
      .form-group input[type="file"] {
        color: var(--text-light);
      }
      .form-card button {
        display: block;
        margin: 20px auto 0;
        padding: 12px 40px;
        background: var(--gold);
        color: #000;
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        font-weight: 500;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .form-card button:hover:enabled {
        background: var(--gold-dark);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }
      .form-card button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      #submitAlert {
        text-align: center;
        margin-top: 15px;
        font-weight: 500;
        font-size: 1rem;
      }

      /* Progress Bar */
      #progressContainer {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        margin-top: 10px;
        overflow: hidden;
        display: none;
      }
      #progressBar {
        width: 0;
        height: 100%;
        background: var(--gold);
        transition: width 0.3s ease;
      }

      /* Testimonial Grid */
      .testimonials-grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
      .testimonial-card {
        background: var(--glass);
        backdrop-filter: blur(12px);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px var(--shadow);
        transition: all 0.3s ease;
      }
      .testimonial-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px var(--shadow);
        background: rgba(255, 215, 0, 0.1);
      }
      .testimonial-card blockquote {
        font-style: italic;
        margin-bottom: 15px;
        color: var(--text-light);
        line-height: 1.5;
      }
      .testimonial-card .byline {
        text-align: right;
        font-weight: 500;
        color: var(--text-muted);
      }
      .testimonial-card img,
      .testimonial-card video {
        display: block;
        max-width: 100%;
        margin: 15px auto 0;
        border-radius: 8px;
        box-shadow: 0 2px 10px var(--shadow);
      }
      .company-response {
        margin-top: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
      }
      .company-response strong {
        display: block;
        margin-bottom: 8px;
        color: var(--gold);
        font-weight: 500;
      }

      /* Footer */
      footer {
        text-align: center;
        padding: 20px 0;
        margin-top: 60px;
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        main {
          padding: 80px 15px 40px;
        }
        .logo img {
          height: 40px;
        }
        .header-card h1 {
          font-size: 2rem;
        }
        .form-card {
          padding: 20px;
        }
        .testimonials-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="logo slide-in">
      <a href="index.html"><img src="CBE_logo.PNG" alt="CBE Logo" /></a>
    </div>
    <button id="theme-toggle" aria-label="Toggle light/dark" class="slide-in">
      ðŸŒž
    </button>

    <main>
      <div class="header-card slide-in">
        <h1>What Our Members Are Saying</h1>
        <p>Real feedback from traders whoâ€™ve grown with CBE.</p>
      </div>

      <div class="form-card slide-in" style="transition-delay: 0.3s;">
        <h2>Share Your Experience</h2>
        <form id="testimonialForm">
          <div class="form-group">
            <label for="name">Your Name<span style="color: red;">*</span></label>
            <input type="text" id="name" name="name" required maxlength="255" />
          </div>
          <div class="form-group">
            <label for="testimonial">Your Testimonial<span style="color: red;">*</span></label>
            <textarea id="testimonial" name="testimonial_text" rows="4" required></textarea>
          </div>
          <div class="form-group">
            <label for="media">Upload Photo or Video (optional)</label>
            <input type="file" id="media" name="media" accept="image/*,video/*" />
            <small style="color: var(--text-muted);">Max. 5 MB (images), no limit (videos)</small>
          </div>

          <div id="progressContainer">
            <div id="progressBar"></div>
          </div>

          <button type="submit" id="submitBtn">Submit for Review</button>
        </form>
        <div id="submitAlert" style="text-align: center; margin-top: 15px; font-weight: 500;"></div>
      </div>

      <section id="testimonialsSection" class="slide-in" style="transition-delay: 0.6s;">
        <h2 style="font-family: 'Poppins', sans-serif; color: var(--gold); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px;">
          Approved Testimonials
        </h2>
        <div class="testimonials-grid" id="testimonialsGrid"></div>
      </section>
    </main>

    <footer class="slide-in" style="transition-delay: 0.9s;">
      Â© 2025 Chukwuemeka Bullion Exchange. All rights reserved.
    </footer>

    <!-- Supabase & Main Script -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js" defer></script>
    <script defer>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".slide-in").forEach((el) => {
          new IntersectionObserver(
            (entries, obs) => {
              entries.forEach((e) => {
                if (e.isIntersecting) {
                  e.target.classList.add("visible");
                  obs.unobserve(e.target);
                }
              });
            },
            { threshold: 0.2, rootMargin: "0px 0px -50px 0px" }
          ).observe(el);
        });

        const toggle = document.getElementById("theme-toggle");
        const setTheme = (t) => {
          document.documentElement.setAttribute("data-theme", t);
          localStorage.setItem("theme", t);
          toggle.textContent = t === "dark" ? "ðŸŒž" : "ðŸŒœ";
        };
        toggle.addEventListener("click", () =>
          setTheme(
            document.documentElement.getAttribute("data-theme") === "dark"
              ? "light"
              : "dark"
          )
        );
        setTheme(localStorage.getItem("theme") || "dark");

        const SUPABASE_URL = "https://dapwpgvnfjcfqqhrpxla.supabase.co";
        const SUPABASE_ANON_KEY =
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhcHdwZ3ZuZmpjZnFxaHJweGxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDA4ODgsImV4cCI6MjA2MjYxNjg4OH0.ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ";
        const supabase = window.supabase.createClient(
          SUPABASE_URL,
          SUPABASE_ANON_KEY
        );

        async function loadTestimonials() {
          const { data, error } = await supabase
            .from("testimonials")
            .select("name,testimonial_text,screenshot_url,video_url,company_response")
            .eq("status", "approved")
            .order("created_at", { ascending: false });
          if (error) return console.error("Fetch error:", error);
          const grid = document.getElementById("testimonialsGrid");
          grid.innerHTML = "";
          data.forEach((t) => {
            const card = document.createElement("div");
            card.className = "testimonial-card";
            let html = `<blockquote>${t.testimonial_text}</blockquote>`;
            html += `<div class="byline">â€” ${t.name}</div>`;
            if (t.screenshot_url) {
              html += `<img src="${t.screenshot_url}" alt="testimonial image"/>`;
            } else if (t.video_url) {
              html += `<video controls><source src="${t.video_url}" type="video/mp4"/></video>`;
            }
            if (t.company_response) {
              html += `<div class="company-response"><strong>Our Response:</strong><p>${t.company_response}</p></div>`;
            }
            card.innerHTML = html;
            grid.appendChild(card);
            new IntersectionObserver(
              (entries, obs) => {
                entries.forEach((e) => {
                  if (e.isIntersecting) {
                    e.target.classList.add("visible");
                    obs.unobserve(e.target);
                  }
                });
              },
              { threshold: 0.2 }
            ).observe(card);
          });
        }
        loadTestimonials();

        const form = document.getElementById("testimonialForm");
        const alertDiv = document.getElementById("submitAlert");
        const submitBtn = document.getElementById("submitBtn");
        const progressContainer = document.getElementById("progressContainer");
        const progressBar = document.getElementById("progressBar");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          alertDiv.textContent = "";
          submitBtn.disabled = true;
          progressBar.style.width = "0%";
          progressContainer.style.display = "block";
          alertDiv.style.color = "var(--text)";
          alertDiv.textContent = "Uploadingâ€¦";

          const name = form.name.value.trim();
          const text = form.testimonial.value.trim();
          if (!name || !text) {
            alertDiv.style.color = "crimson";
            alertDiv.textContent = "Please fill both name & testimonial.";
            submitBtn.disabled = false;
            progressContainer.style.display = "none";
            return;
          }

          let screenshot_url = null, video_url = null;
          const file = form.media.files[0];
          if (file) {
            if (file.type.startsWith("image/") && file.size > 5 * 1024 * 1024) {
              alertDiv.style.color = "crimson";
              alertDiv.textContent = "Image must be under 5 MB.";
              submitBtn.disabled = false;
              progressContainer.style.display = "none";
              return;
            }

            const bucket = file.type.startsWith("image/")
              ? "testimonial-screenshots"
              : "testimonial-videos";
            const path = `${bucket}/${Date.now()}_${file.name}`;

            const { error: uploadErr } = await supabase.storage
              .from(bucket)
              .upload(path, file, {
                onProgress: (evt) => {
                  const pct = Math.round((evt.loaded / evt.total) * 100);
                  progressBar.style.width = pct + "%";
                  alertDiv.textContent = `Uploadingâ€¦ ${pct}%`;
                },
              });
            if (uploadErr) {
              console.error("Upload Error â†’", uploadErr);
              alertDiv.style.color = "crimson";
              alertDiv.textContent = `Upload failed: ${uploadErr.message}`;
              submitBtn.disabled = false;
              progressContainer.style.display = "none";
              return;
            }

            const { data: urlData, error: urlErr } = await supabase.storage
              .from(bucket)
              .getPublicUrl(path);
            if (urlErr) {
              console.error("GetPublicUrl Error â†’", urlErr);
              alertDiv.style.color = "crimson";
              alertDiv.textContent = `Couldnâ€™t get URL: ${urlErr.message}`;
              submitBtn.disabled = false;
              progressContainer.style.display = "none";
              return;
            }

            if (file.type.startsWith("image/")) screenshot_url = urlData.publicUrl;
            else video_url = urlData.publicUrl;
          }

          const { error: insertErr } = await supabase
            .from("testimonials")
            .insert([
              { name, testimonial_text: text, screenshot_url, video_url, status: "pending" },
            ]);
          if (insertErr) {
            console.error("Insert Error â†’", insertErr);
            alertDiv.style.color = "crimson";
            alertDiv.textContent = `Submit failed: ${insertErr.message}`;
          } else {
            alertDiv.style.color = "lightgreen";
            alertDiv.textContent = "Thanksâ€”awaiting approval!";
            form.reset();
          }

          submitBtn.disabled = false;
          progressContainer.style.display = "none";
        });
      });
    </script>

    <!-- Smartsupp Live Chat script -->
    <script type="text/javascript">
      var _smartsupp = _smartsupp || {};
      _smartsupp.key = '018a8bbd868518221e725341a7b2601231ec7ce8';
      window.smartsupp||(function(d) {
        var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
        s=d.getElementsByTagName('script')[0];c=d.createElement('script');
        c.type='text/javascript';c.charset='utf-8';c.async=true;
        c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
      })(document);
    </script>
  </body>
</html>
