<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login â€¢ Chukwuemeka Bullion Exchange</title>
  <meta name="description" content="Login to Chukwuemeka Bullion Exchangeâ€™s VIP trading community."/>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet"/>
  
  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    /* LUXURY BLACK & GOLD THEME                                                                  */
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    
    /* Dark Theme Variables */
    :root[data-theme="dark"] {
      --bg: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      --text: #f0f0f0;
      --gold: #d4af37;
      --gold-light: #e6c55c;
      --gold-dark: #b3932b;
      --gold-gradient: linear-gradient(135deg, #d4af37 0%, #f9e076 100%);
      --card-bg: rgba(20, 20, 20, 0.85);
      --card-border: 1px solid rgba(212, 175, 55, 0.2);
      --input-bg: rgba(30, 30, 30, 0.8);
      --text-light: #bbbbbb;
      --text-muted: #888888;
      --error-color: #e74c3c;
      --success-color: #2ecc71;
      --warning-color: #f39c12;
      --gold-glow: 0 0 15px rgba(212, 175, 55, 0.4);
      --gold-shadow: 0 4px 30px rgba(212, 175, 55, 0.15);
    }
    
    /* RESET & BASE */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex; align-items: center; justify-content: center;
      min-height: 100vh; overflow: hidden; position: relative;
    }

    /* Background Elements */
    .gold-line { position: absolute; background: var(--gold); opacity: 0.1; z-index: -1; }
    .gold-circle {
      position: absolute; border: 1px solid var(--gold);
      border-radius: 50%; opacity: 0.05; z-index: -1;
      animation: float 20s infinite ease-in-out;
    }
    @keyframes float {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(20px); }
    }

    /* LOGIN CARD */
    .login-card {
      width: 100%; max-width: 460px;
      background: var(--card-bg); backdrop-filter: blur(12px);
      padding: 45px 35px; border-radius: 16px; border: var(--card-border);
      box-shadow: var(--gold-shadow), 0 10px 50px rgba(0,0,0,0.3);
      position: relative; z-index: 10;
      opacity: 0; transform: translateY(30px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }
    .login-card.visible { opacity:1; transform: translateY(0); }
    .login-card::before {
      content: ''; position: absolute; top:-2px; left:-2px; right:-2px; bottom:-2px;
      background: var(--gold-gradient); border-radius:18px; opacity:0.1; z-index:-1;
    }

    .login-card h1 {
      font-family:'Playfair Display', serif; font-size:2.2rem;
      background:var(--gold-gradient); -webkit-background-clip:text;
      background-clip:text; color:transparent; text-align:center;
      margin-bottom:10px;
    }
    .login-card .greeting {
      text-align:center; font-size:1.1rem; margin-bottom:5px;
      color:var(--text-light);
    }
    .login-card .quote {
      text-align:center; font-size:0.9rem; font-style:italic;
      color:var(--text-muted); margin-bottom:20px;
    }

    /* Form Elements */
    .form-group { margin-bottom:20px; position:relative; }
    label {
      display:block; font-size:0.95rem; color:var(--text-light);
      margin-bottom:8px; font-weight:500; letter-spacing:0.3px;
    }
    .input-container {
      position:relative;
    }
    input {
      width:100%; padding:14px 18px 14px 48px;
      border:1px solid rgba(212,175,55,0.3); border-radius:8px;
      background:var(--input-bg); color:var(--text);
      font-size:1rem; transition:all .3s;
    }
    input:focus {
      outline:none; border-color:var(--gold); box-shadow:var(--gold-glow);
    }
    .input-icon {
      position:absolute; left:18px; top:50%; transform:translateY(-50%);
      color:var(--gold); font-size:18px;
    }
    .toggle-pw {
      position:absolute; right:14px; top:50%; transform:translateY(-50%);
      color:var(--text-light); cursor:pointer; font-size:18px;
    }

    /* Remember & Social */
    .extras { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .remember { display:flex; align-items:center; font-size:0.9rem; color:var(--text-light); }
    .remember input { margin-right:6px; accent-color:var(--gold); }
    .social-login { display:flex; gap:12px; }
    .social-login button {
      background:var(--input-bg); border:1px solid rgba(212,175,55,0.3);
      border-radius:6px; padding:10px; cursor:pointer;
      transition:all .3s; font-size:0.9rem; color:var(--text-light);
    }
    .social-login button:hover { background:rgba(212,175,55,0.1); }

    /* Submit Button */
    button[type="submit"] {
      width:100%; padding:16px; border:none; border-radius:8px;
      background:var(--gold-gradient); color:#1a1a1a;
      font-weight:700; font-size:1.05rem; cursor:pointer;
      box-shadow:var(--gold-shadow); position:relative;
      transition:all .3s; letter-spacing:0.5px;
    }
    button[type="submit"]:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(212,175,55,0.4); }
    button[type="submit"]:disabled { opacity:.6; cursor:not-allowed; }
    .spinner {
      display:none; width:20px; height:20px;
      border:3px solid rgba(26,26,26,0.3); border-top:3px solid #1a1a1a;
      border-radius:50%; animation:spin .8s linear infinite;
      position:absolute; right:20px; top:50%; transform:translateY(-50%);
    }

    @keyframes spin { 0%{transform:translateY(-50%) rotate(0)}100%{transform:translateY(-50%) rotate(360deg)} }

    /* Alert */
    #login-alert {
      margin-top:20px; padding:15px; border-radius:8px;
      text-align:center; font-weight:600; font-size:0.95rem;
      opacity:0; transform:translateY(10px);
      transition:all .4s ease;
    }
    #login-alert.show { opacity:1; transform:translateY(0); }
    #login-alert.error {
      background:rgba(231,76,60,0.1); color:var(--error-color);
      border:1px solid rgba(231,76,60,0.3);
    }

    /* Logo & Toggle & Footer */
    .logo {
      position:fixed; top:30px; left:30px; z-index:100;
    }
    .logo img {
      width:150px; filter:drop-shadow(0 2px 5px rgba(0,0,0,0.3));
    }
    #theme-toggle {
      position:fixed; top:30px; right:30px; width:50px; height:50px;
      background:var(--card-bg); backdrop-filter:blur(10px);
      border-radius:50%; border:1px solid rgba(212,175,55,0.2);
      box-shadow:0 4px 15px rgba(0,0,0,0.1);
      font-size:1.4rem; color:var(--gold); cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition:all .3s; z-index:100;
    }
    #theme-toggle:hover { transform:rotate(15deg); box-shadow:0 0 15px rgba(212,175,55,0.3); }
    footer {
      position:fixed; bottom:25px; width:100%; text-align:center;
      color:var(--text-muted); font-size:0.85rem; letter-spacing:0.3px;
      z-index:100;
    }

    /* Circles & Lines */
    .line-1 { top:0; left:20%; width:1px; height:100%; }
    .line-2 { top:0; left:40%; width:1px; height:100%; }
    .line-3 { top:0; left:60%; width:1px; height:100%; }
    .line-4 { top:0; left:80%; width:1px; height:100%; }
    .circle-1 { width:300px; height:300px; top:-150px; left:-150px; }
    .circle-2 { width:500px; height:500px; bottom:-250px; right:-250px; }

    /* Responsive */
    @media (max-width:768px) {
      .login-card { padding:30px 25px; max-width:90%; }
      .logo img { width:120px; }
      #theme-toggle { width:44px; height:44px; font-size:1.2rem; }
    }
  </style>
</head>
<body>
  <!-- Background Elements -->
  <div class="gold-line line-1"></div>
  <div class="gold-line line-2"></div>
  <div class="gold-line line-3"></div>
  <div class="gold-line line-4"></div>
  <div class="gold-circle circle-1"></div>
  <div class="gold-circle circle-2"></div>

  <!-- LOGO -->
  <div class="logo">
    <a href="index.html">
      <img src="CBE_logo.PNG" alt="CBE Logo"/>
    </a>
  </div>

  <!-- THEME TOGGLE -->
  <button id="theme-toggle" aria-label="Toggle theme">ðŸŒž</button>

  <!-- LOGIN CARD -->
  <div class="login-card" id="login-card">
    <h1>Member Login</h1>
    <div class="greeting" id="greeting"></div>
    <div class="quote" id="quote"></div>
    <form id="login-form">
      <div class="form-group">
        <label for="email">Email Address</label>
        <div class="input-container">
          <i class="fas fa-envelope input-icon"></i>
          <input type="email" id="email" required placeholder="Enter your email address"/>
        </div>
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <div class="input-container">
          <i class="fas fa-lock input-icon"></i>
          <input type="password" id="password" required placeholder="Enter your password"/>
          <i class="fas fa-eye toggle-pw" id="toggle-pw"></i>
        </div>
      </div>
      <div class="extras">
        <label class="remember">
          <input type="checkbox" id="remember-me"/> Remember me
        </label>
        <div class="social-login">
          <button type="button"><i class="fab fa-google"></i> Google</button>
          <button type="button"><i class="fab fa-facebook-f"></i> Facebook</button>
        </div>
      </div>
      <button type="submit" id="login-button">
        Log In
        <div class="spinner" id="login-spinner"></div>
      </button>
    </form>
    <div id="login-alert"></div>
  </div>

  <footer>Â© 2025 Chukwuemeka Bullion Exchange. All rights reserved.</footer>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script>
    // â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const quotes = [
      "Success usually comes to those who are too busy to be looking for it.",
      "The harder you work for something, the greater youâ€™ll feel when you achieve it.",
      "Donâ€™t stop when youâ€™re tired. Stop when youâ€™re done."
    ];
    function greet() {
      const h = new Date().getHours();
      if (h < 12) return "Good morning";
      if (h < 18) return "Good afternoon";
      return "Good evening";
    }

    // â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const loginCard = document.getElementById('login-card');
    const toggleBtn = document.getElementById('theme-toggle');
    const greetingEl = document.getElementById('greeting');
    const quoteEl    = document.getElementById('quote');
    const emailInput = document.getElementById('email');
    const pwInput    = document.getElementById('password');
    const togglePw   = document.getElementById('toggle-pw');
    const rememberEl = document.getElementById('remember-me');

    window.addEventListener('DOMContentLoaded', () => {
      // show card
      loginCard.classList.add('visible');
      // greeting & quote
      greetingEl.textContent = `${greet()}, welcome back!`;
      quoteEl.textContent = quotes[Math.floor(Math.random()*quotes.length)];
      // theme
      const savedTheme = localStorage.getItem('theme')||'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      toggleBtn.textContent = savedTheme==='dark'?'ðŸŒž':'ðŸŒœ';
      // remember email
      const remEmail = localStorage.getItem('cbe_remember');
      if(remEmail) {
        emailInput.value = remEmail;
        rememberEl.checked = true;
      }
    });

    toggleBtn.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur==='dark'?'light':'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      toggleBtn.textContent = next==='dark'?'ðŸŒž':'ðŸŒœ';
    });

    // show/hide password
    togglePw.addEventListener('click', () => {
      const t = pwInput.getAttribute('type');
      pwInput.setAttribute('type', t==='password'?'text':'password');
      togglePw.classList.toggle('fa-eye-slash');
    });

    // â”€â”€â”€ SUPABASE LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const SUPA_URL      = 'https://dapwpgvnfjcfqqhrpxla.supabase.co';
    const SUPA_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhcHdwZ3ZuZmpjZnFxaHJweGxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDA4ODgsImV4cCI6MjA2MjYxNjg4OH0.ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ';
    const sb = supabase.createClient(SUPA_URL, SUPA_ANON_KEY);

    const form      = document.getElementById('login-form');
    const btn       = document.getElementById('login-button');
    const spinner   = document.getElementById('login-spinner');
    const alertDiv  = document.getElementById('login-alert');
    const errorsMap = {
      'JSON object requested': 'Invalid email or password.',
      'multiple':               'Invalid email or password.',
      'no rows':                'Invalid email or password.',
      'No account found for that email.': 'No account found with this email.',
      'Invalid login credentials.':      'Incorrect password.',
      'Your account is not yet approvedâ€”please check back soon.':
        'Your account is pending approval.'
    };

    form.addEventListener('submit', async e => {
      e.preventDefault();
      alertDiv.className=''; alertDiv.textContent='';
      // remember me
      if(rememberEl.checked) localStorage.setItem('cbe_remember', emailInput.value.trim());
      else localStorage.removeItem('cbe_remember');
      // show spinner
      spinner.style.display='block'; btn.disabled=true;

      const email = emailInput.value.trim().toLowerCase();
      const password = pwInput.value;

      try {
        const { data:user, error, count } = await sb
          .from('users')
          .select('id,name,email,password,status',{count:'exact'})
          .ilike('email',email)
          .limit(1).maybeSingle();
        if(error) throw error;
        if(count===0) throw new Error('No account found for that email.');
        if(user.password!==password) throw new Error('Invalid login credentials.');
        if(String(user.status).toLowerCase()!=='approved')
          throw new Error('Your account is not yet approvedâ€”please check back soon.');

        // device & brevo (unchanged)...
        const deviceKey=`cbeDevice_${email}`, saved=localStorage.getItem(deviceKey), curr=navigator.userAgent;
        if(!saved) localStorage.setItem(deviceKey,curr);
        else if(saved!==curr) {
          localStorage.setItem(deviceKey,curr);
          // send brevo alert...
          const BREVO_API_KEY="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",
                TEMPLATE_ID_LOGIN=3;
          fetch("https://api.brevo.com/v3/smtp/email",{
            method:"POST",
            headers:{"Content-Type":"application/json","api-key":BREVO_API_KEY},
            body:JSON.stringify({
              sender:{name:"Chukwuemeka Bullion Exchange",email:"noreply@apexincomeoptions.com.ng"},
              to:[{email:user.email,name:user.name}],
              templateId:TEMPLATE_ID_LOGIN,
              params:{
                contact:{FIRSTNAME:user.name,EMAIL:user.email},
                DEVICE:curr,
                TIME:new Date().toLocaleString("en-US",{timeZone:"Africa/Lagos"})
              }
            })
          }).catch(console.error);
        }

        // success â†’ redirect
        sessionStorage.setItem('cbeLoggedIn','true');
        sessionStorage.setItem('cbeUserId',user.id);
        sessionStorage.setItem('cbeUserName',user.name);
        setTimeout(()=> window.location.href='vip-dashboard.html',800);
      }
      catch(err) {
        console.error(err);
        // map friendly
        let msg = Object.entries(errorsMap).find(([k])=>err.message.includes(k))?.[1]
               || 'An unexpected error occurred.';
        alertDiv.textContent = msg;
        alertDiv.classList.add('show','error');
      }
      finally {
        spinner.style.display='none'; btn.disabled=false;
      }
    });
  </script>

  <!-- Smartsupp Live Chat (optional) -->
  <script type="text/javascript">
    var _smartsupp=_smartsupp||{};_smartsupp.key='018a8bbd868518221e725341a7b2601231ec7ce8';
    window.smartsupp||(function(d){var s,c,o=smartsupp=function(){o._.push(arguments)};o._=[];s=d.getElementsByTagName('script')[0];
    c=d.createElement('script');c.type='text/javascript';c.charset='utf-8';c.async=true;
    c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
    })(document);
  </script>
</body>
</html>
