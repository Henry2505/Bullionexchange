<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login • Chukwuemeka Bullion Exchange</title>
  <meta name="description" content="Login to Chukwuemeka Bullion Exchange’s VIP trading community."/>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet"/>

  <style>
    /* Enable smooth scrolling */
    html { scroll-behavior: smooth; }

    /* Dark Theme Variables */
    :root[data-theme="dark"] {
      --bg: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      --text: #f0f0f0;
      --gold: #d4af37;
      --gold-light: #e6c55c;
      --gold-dark: #b3932b;
      --gold-gradient: linear-gradient(135deg, #d4af37 0%, #f9e076 100%);
      --card-bg: rgba(20, 20, 20, 0.85);
      --card-border: 1px solid rgba(212, 175, 55, 0.2);
      --input-bg: rgba(30, 30, 30, 0.8);
      --text-light: #bbbbbb;
      --text-muted: #888888;
      --error-color: #e74c3c;
      --success-color: #2ecc71;
      --warning-color: #f39c12;
      --gold-glow: 0 0 15px rgba(212, 175, 55, 0.4);
      --gold-shadow: 0 4px 30px rgba(212, 175, 55, 0.15);
    }
    /* Light Theme Variables */
    :root[data-theme="light"] {
      --bg: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
      --text: #222222;
      --gold: #d4af37;
      --gold-light: #c5a12d;
      --gold-dark: #b3932b;
      --gold-gradient: linear-gradient(135deg, #d4af37 0%, #b3932b 100%);
      --card-bg: rgba(255, 255, 255, 0.9);
      --card-border: 1px solid rgba(212, 175, 55, 0.3);
      --input-bg: rgba(245, 245, 245, 0.9);
      --text-light: #555555;
      --text-muted: #666666;
      --error-color: #e74c3c;
      --success-color: #27ae60;
      --warning-color: #e67e22;
      --gold-glow: 0 0 10px rgba(212, 175, 55, 0.3);
      --gold-shadow: 0 4px 25px rgba(212, 175, 55, 0.2);
    }

    /* Base Styles */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex; align-items: center; justify-content: center;
      min-height: 100vh; padding: 20px; position: relative; overflow: hidden;
    }

    /* Background Elements */
    .gold-line { position: absolute; background: var(--gold); opacity: 0.1; z-index: -1; }
    .line-1 { top: 0; left: 20%; width: 1px; height: 100%; }
    .line-2 { top: 0; left: 40%; width: 1px; height: 100%; }
    .line-3 { top: 0; left: 60%; width: 1px; height: 100%; }
    .line-4 { top: 0; left: 80%; width: 1px; height: 100%; }

    .gold-circle {
      position: absolute; border: 1px solid var(--gold);
      border-radius: 50%; opacity: 0.05; z-index: -1;
      transition: transform 0.3s ease-out;
    }
    .circle-1 { width: 300px; height: 300px; top: -150px; left: -150px; }
    .circle-2 { width: 500px; height: 500px; bottom: -250px; right: -250px; }

    /* LOGIN CARD */
    .login-card {
      width: 100%; max-width: 500px;
      background: var(--card-bg); backdrop-filter: blur(12px);
      padding: 40px 35px; border-radius: 16px; border: var(--card-border);
      box-shadow: var(--gold-shadow), 0 10px 50px rgba(0,0,0,0.3);
      position: relative; overflow: hidden;
      opacity: 0; transform: translateY(30px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
      z-index: 100;
    }
    .login-card.visible { opacity: 1; transform: translateY(0); }
    .login-card::before {
      content: ''; position: absolute;
      top: -2px; left: -2px; right: -2px; bottom: -2px;
      background: var(--gold-gradient); z-index: -1;
      border-radius: 18px; opacity: 0.1;
    }

    .login-card h1 {
      font-family: 'Playfair Display', serif; font-size: 2.2rem;
      background: var(--gold-gradient); -webkit-background-clip: text;
      background-clip: text; color: transparent;
      text-align: center; margin-bottom: 10px;
      letter-spacing: 0.5px; position: relative;
      padding-bottom: 20px;
    }
    .login-card h1::after {
      content: ''; display: block; width: 80px; height: 3px;
      background: var(--gold-gradient); margin: 12px auto 0;
      border-radius: 2px;
    }

    .subtitle {
      font-size: 1.1rem; color: var(--text-light);
      text-align: center; margin-bottom: 20px;
    }

    /* Remember Me under the dash */
    .remember-me {
      margin: 15px 0 30px;
      text-align: center;
    }
    .remember-me input { margin-right: 8px; accent-color: var(--gold); }
    .remember-me label { font-size: 1.1rem; font-weight: 600; color: var(--gold); }

    /* Form Elements */
    .form-group { margin-bottom: 25px; position: relative; }
    label {
      display: block; font-size: 0.95rem; color: var(--text-light);
      margin-bottom: 8px; font-weight: 500; letter-spacing: 0.3px;
    }
    .input-container { position: relative; }
    input {
      width: 100%; padding: 14px 18px 14px 48px;
      border: 1px solid rgba(212,175,55,0.3); border-radius: 8px;
      background: var(--input-bg); color: var(--text);
      font-size: 1rem; transition: all 0.3s ease;
    }
    input:focus {
      outline: none; border-color: var(--gold);
      box-shadow: var(--gold-glow);
    }
    .input-icon {
      position: absolute; left: 18px; top: 50%;
      transform: translateY(-50%); color: var(--gold);
      font-size: 18px;
    }

    .toggle-password {
      position: absolute; right: 18px; top: 50%;
      transform: translateY(-50%); cursor: pointer;
      color: var(--gold); transition: color 0.3s ease;
    }
    .toggle-password:hover { color: var(--gold-light); }

    button {
      padding: 16px; border: none; border-radius: 8px;
      background: var(--gold-gradient); color: #1a1a1a;
      font-weight: 700; font-size: 1.05rem; cursor: pointer;
      transition: all 0.3s ease; letter-spacing: 0.5px;
      position: relative; overflow: hidden; box-shadow: var(--gold-shadow);
      margin-top: 20px;
    }
    button::before {
      content: ''; position: absolute; top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: 0.5s;
    }
    button:hover::before { left: 100%; }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212,175,55,0.4);
    }
    button:active { transform: translateY(0); }
    .spinner {
      display: none; width: 20px; height: 20px;
      border: 3px solid rgba(26,26,26,0.3);
      border-top: 3px solid #1a1a1a; border-radius: 50%;
      animation: spin 0.8s linear infinite;
      position: absolute; right: 20px; top: 50%;
      transform: translateY(-50%);
    }
    @keyframes spin {
      0% { transform: translateY(-50%) rotate(0deg); }
      100% { transform: translateY(-50%) rotate(360deg); }
    }

    #login-alert {
      margin-top: 20px; padding: 15px; border-radius: 8px;
      text-align: center; font-weight: 600; font-size: 0.95rem;
      opacity: 0; transform: translateY(10px);
      transition: all 0.4s ease;
    }
    #login-alert.show { opacity: 1; transform: translateY(0); }
    #login-alert.error {
      background: rgba(231,76,60,0.1); color: var(--error-color);
      border: 1px solid rgba(231,76,60,0.3);
    }

    .logo {
      position: fixed; top: 30px; left: 30px; z-index: 50;
      animation: logoFadeIn 1s ease-in;
    }
    .logo img {
      width: 150px; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
    }

    #theme-toggle {
      position: fixed; top: 30px; right: 30px;
      width: 50px; height: 50px; background: var(--card-bg);
      backdrop-filter: blur(10px); border-radius: 50%;
      border: 1px solid rgba(212,175,55,0.2);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      font-size: 1.4rem; color: var(--gold);
      cursor: pointer; display: flex; align-items: center;
      justify-content: center; transition: all 0.3s ease; z-index: 100;
    }
    #theme-toggle:hover { transform: rotate(15deg); box-shadow: 0 0 15px rgba(212,175,55,0.3); }

    footer {
      position: fixed; bottom: 25px; width: 100%; text-align: center;
      color: var(--text-muted); font-size: 0.85rem; letter-spacing: 0.3px;
      z-index: 100; animation: fadeIn 2s ease-in;
    }

    #particles { position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 0; pointer-events: none; }
    .particle {
      position: absolute; background: var(--gold);
      border-radius: 50%; opacity: 0.3; animation: float 5s infinite ease-in-out;
    }
    @keyframes float {
      0% { transform: translateY(0); opacity: 0.3; }
      50% { transform: translateY(-20px); opacity: 0.5; }
      100% { transform: translateY(0); opacity: 0.3; }
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes logoFadeIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    @media (max-width: 768px) {
      .login-card { padding: 30px 25px; max-width: 90%; }
      .logo { top: 20px; left: 20px; }
      .logo img { width: 120px; }
      #theme-toggle { top: 25px; right: 25px; width: 44px; height: 44px; font-size: 1.2rem; }
      footer { bottom: 15px; font-size: 0.8rem; }
    }
    @media (max-width: 480px) {
      .login-card { padding: 25px 20px; }
      .login-card h1 { font-size: 1.9rem; }
      input { padding: 12px 15px 12px 42px; }
      .input-icon { font-size: 16px; left: 15px; }
      .subtitle { font-size: 1rem; }
      .logo img { width: 100px; }
      .remember-me { width: 90%; max-width: 300px; margin: 15px auto 30px; }
    }
  </style>
</head>
<body>
  <!-- Background Elements -->
  <div class="gold-line line-1"></div>
  <div class="gold-line line-2"></div>
  <div class="gold-line line-3"></div>
  <div class="gold-line line-4"></div>
  <div class="gold-circle circle-1"></div>
  <div class="gold-circle circle-2"></div>

  <!-- Particle Background -->
  <div id="particles"></div>

  <!-- LOGO -->
  <div class="logo">
    <a href="index.html"><img src="CBE_logo.PNG" alt="CBE Logo"/></a>
  </div>

  <!-- THEME TOGGLE -->
  <button id="theme-toggle" aria-label="Toggle theme">🌞</button>

  <!-- LOGIN CARD -->
  <div class="login-card" id="login-card">
    <div id="greeting"></div>
    <div id="quote"></div>
    <h1>Member Login</h1>
    <p class="subtitle">Access your VIP trading account</p>

    <!-- Remember Me under the dash -->
    <div class="form-group remember-me">
      <input type="checkbox" id="remember-me"/>
      <label for="remember-me">Remember me</label>
    </div>

    <form id="login-form">
      <div class="form-group">
        <label for="email">Email Address</label>
        <div class="input-container">
          <i class="fas fa-envelope input-icon"></i>
          <input type="email" id="email" required placeholder="Enter your email address"/>
        </div>
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <div class="input-container">
          <i class="fas fa-lock input-icon"></i>
          <input type="password" id="password" required placeholder="Enter your password"/>
          <i class="fas fa-eye toggle-password" id="toggle-password"></i>
        </div>
      </div>
      <button type="submit" id="login-button">
        Log In
        <div class="spinner" id="login-spinner"></div>
      </button>
    </form>

    <div id="login-alert"></div>

    <div class="additional-info">
      <p>Having trouble? <a href="mailto:support@apexincomeoptions.com.ng">Contact Support</a></p>
    </div>
  </div>

  <footer>© 2025 Chukwuemeka Bullion Exchange. All rights reserved.</footer>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script>
    // Setup & Theme Toggle
    const loginCard = document.getElementById('login-card');
    const toggleBtn = document.getElementById('theme-toggle');

    window.addEventListener('DOMContentLoaded', () => {
      loginCard.classList.add('visible');
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      toggleBtn.textContent = savedTheme === 'dark' ? '🌞' : '🌜';
      document.querySelectorAll('.gold-line, .gold-circle').forEach(el => {
        el.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--gold');
      });
      createParticles();
    });

    toggleBtn.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      toggleBtn.textContent = next === 'dark' ? '🌞' : '🌜';
    });

    // Initialize Supabase
    const SUPA_URL = 'https://dapwpgvnfjcfqqhrpxla.supabase.co';
    const SUPA_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhcHdwZ3ZuZmpjZnFxaHJweGxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNDA4ODgsImV4cCI6MjA2MjYxNjg4OH0.ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ';
    const sb = supabase.createClient(SUPA_URL, SUPA_ANON_KEY);

    // Login Form Handling
    const loginForm = document.getElementById('login-form');
    const loginButton = document.getElementById('login-button');
    const loginSpinner = document.getElementById('login-spinner');
    const alertDiv = document.getElementById('login-alert');
    const rememberMeCheckbox = document.getElementById('remember-me');
    const emailInput = document.getElementById('email');

    const errorMessages = {
      'No account found for that email.': 'No account found with this email address.',
      'Invalid login credentials.': 'Incorrect password. Please try again.',
      'Your account is not yet approved—please check back soon.': 'Your account is pending approval. Please contact support.',
      'JSON object requested multiple': 'Authentication error. Please try again later.',
      'no rows returned': 'Account not found. Please check your credentials.',
      'default': 'An unexpected error occurred. Please try again later.'
    };

    const rememberedEmail = localStorage.getItem('rememberedEmail');
    if (rememberedEmail) {
      emailInput.value = rememberedEmail;
      rememberMeCheckbox.checked = true;
    }

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      alertDiv.textContent = '';
      alertDiv.className = '';

      const email = emailInput.value.trim().toLowerCase();
      const password = document.getElementById('password').value;

      loginSpinner.style.display = 'block';
      loginButton.disabled = true;

      try {
        const { data: user, error, count } = await sb
          .from('users')
          .select('id, name, email, password, status', { count: 'exact' })
          .ilike('email', email)
          .limit(1)
          .maybeSingle();

        if (error) {
          if (error.message.includes('no rows')) throw new Error('no rows returned');
          if (error.message.includes('multiple')) throw new Error('JSON object requested multiple');
          throw new Error('default');
        }
        if (count === 0) throw new Error('No account found for that email.');
        if (user.password !== password) throw new Error('Invalid login credentials.');
        if (String(user.status).toLowerCase() !== 'approved') throw new Error('Your account is not yet approved—please check back soon.');

        // Device tracking & Brevo alert
        const deviceKey = `cbeDevice_${email}`;
        const savedDevice = localStorage.getItem(deviceKey);
        const currentDevice = navigator.userAgent;
        if (!savedDevice || savedDevice !== currentDevice) {
          localStorage.setItem(deviceKey, currentDevice);
          const BREVO_API_KEY = "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";
          const TEMPLATE_ID_LOGIN = 3;
          const brevoPayload = {
            sender: { name: "Chukwuemeka Bullion Exchange", email: "noreply@apexincomeoptions.com.ng" },
            to: [{ email: user.email, name: user.name }],
            templateId: TEMPLATE_ID_LOGIN,
            params: {
              contact: { FIRSTNAME: user.name, EMAIL: user.email },
              DEVICE: currentDevice,
              TIME: new Date().toLocaleString("en-US", { timeZone: "Africa/Lagos" })
            }
          };
          fetch("https://api.brevo.com/v3/smtp/email", {
            method: "POST",
            headers: { "Content-Type": "application/json", "api-key": BREVO_API_KEY },
            body: JSON.stringify(brevoPayload)
          }).catch(console.error);
        }

        if (rememberMeCheckbox.checked) localStorage.setItem('rememberedEmail', email);
        else localStorage.removeItem('rememberedEmail');

        sessionStorage.setItem('cbeLoggedIn', 'true');
        sessionStorage.setItem('cbeUserId', user.id);
        sessionStorage.setItem('cbeUserName', user.name);
        setTimeout(() => { window.location.href = 'vip-dashboard.html'; }, 1000);

      } catch (err) {
        console.error("Login error:", err);
        const msg = errorMessages[err.message] || errorMessages['default'];
        alertDiv.textContent = msg;
        alertDiv.classList.add('show', 'error');
        loginSpinner.style.display = 'none';
        loginButton.disabled = false;
      }
    });

    // Greeting & Quote
    const greetingDiv = document.getElementById('greeting');
    const hour = new Date().getHours();
    let greeting = hour < 12 ? "Good morning" : hour < 17 ? "Good afternoon" : "Good evening";
    greetingDiv.innerHTML = `<p>${greeting}, welcome back!</p>`;

    const quotes = [
      "Believe you can and you're halfway there.",
      "The only way to do great work is to love what you do.",
      "Success is not final, failure is not fatal: It is the courage to continue that counts.",
      "Don’t watch the clock; do what it does. Keep going.",
      "Keep your eyes on the stars and your feet on the ground.",
      "The best way to predict the future is to create it.",
      "You are never too old to set another goal or to dream a new dream."
    ];
    document.getElementById('quote').innerHTML = `<p>${quotes[Math.floor(Math.random() * quotes.length)]}</p>`;

    // Show/Hide Password
    const togglePassword = document.getElementById('toggle-password');
    const passwordInput = document.getElementById('password');
    togglePassword.addEventListener('click', () => {
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        togglePassword.classList.replace('fa-eye', 'fa-eye-slash');
      } else {
        passwordInput.type = 'password';
        togglePassword.classList.replace('fa-eye-slash', 'fa-eye');
      }
    });

    // Parallax Circles
    window.addEventListener('mousemove', e => {
      const x = e.clientX / window.innerWidth;
      const y = e.clientY / window.innerHeight;
      document.querySelector('.circle-1').style.transform = `translate(${x*20}px, ${y*20}px)`;
      document.querySelector('.circle-2').style.transform = `translate(${x*-20}px, ${y*-20}px)`;
    });

    // Particle Background
    function createParticles() {
      const container = document.getElementById('particles');
      for (let i=0; i<20; i++) {
        const p = document.createElement('div');
        p.classList.add('particle');
        p.style.width = `${Math.random()*5+2}px`;
        p.style.height = p.style.width;
        p.style.left = `${Math.random()*100}%`;
        p.style.top = `${Math.random()*100}%`;
        p.style.animationDelay = `${Math.random()*5}s`;
        container.appendChild(p);
      }
    }

    // Input Validation Feedback
    emailInput.addEventListener('input', () => {
      emailInput.style.borderColor = emailInput.validity.valid
        ? 'var(--success-color)' : 'var(--error-color)';
    });
    passwordInput.addEventListener('input', () => {
      passwordInput.style.borderColor = passwordInput.value.length >= 6
        ? 'var(--success-color)' : 'var(--error-color)';
    });
  </script>

  <!-- Smartsupp Live Chat (optional) -->
  <script type="text/javascript">
    var _smartsupp = _smartsupp || {};
    _smartsupp.key = '018a8bbd868518221e725341a7b2601231ec7ce8';
    window.smartsupp||(function(d) {
      var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
      s=d.getElementsByTagName('script')[0];c=d.createElement('script');
      c.type='text/javascript';c.charset='utf-8';c.async=true;
      c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
    })(document);
  </script>
</body>
</html>
