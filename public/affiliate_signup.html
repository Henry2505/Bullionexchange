<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Register as an affiliate and get your unique referral code." />
  <title>Affiliate Signup • CBE Global</title>

  <!-- Google Fonts (optional) -->
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap"
    rel="stylesheet"
  />

  <!-- Bootstrap 5.3 CSS & Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    rel="stylesheet"
  />

  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

  <style>
    /* Dark / Light theme variables */
    :root[data-theme="dark"] {
      --bg: #121212;
      --text: #e0e0e0;
      --accent-bg: rgba(30, 30, 30, 0.7);
      --gold: #ffd700;
      --gold-dark: #cca300;
      --text-light: #bbbbbb;
      --error-color: #e74c3c;
      --success-color: #2ecc71;
      --border-color: #333;
    }
    :root[data-theme="light"] {
      --bg: #fafafa;
      --text: #222222;
      --accent-bg: rgba(255, 255, 255, 0.7);
      --gold: #cca300;
      --gold-dark: #b58900;
      --text-light: #555;
      --error-color: #e74c3c;
      --success-color: #2ecc71;
      --border-color: #ddd;
    }
    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    a { color: var(--gold); text-decoration: none; }
    a:hover { color: var(--gold-dark); text-decoration: underline; }

    .signup-card {
      background: var(--accent-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      width: 100%;
      max-width: 450px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .signup-card.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .signup-card h1 {
      margin-bottom: 1.5rem;
      font-size: 1.75rem;
      color: var(--gold);
      text-align: center;
    }

    .form-group { margin-bottom: 1rem; }
    label {
      display: block;
      margin-bottom: .25rem;
      color: var(--text-light);
      font-weight: 500;
      font-size: .95rem;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: .5rem .75rem;
      border: 1px solid var(--gold);
      border-radius: 6px;
      background: rgba(28,28,28,0.8);
      color: var(--text);
      font-size: 1rem;
      transition: box-shadow .3s ease;
    }
    input:focus {
      outline: none;
      box-shadow: 0 0 8px var(--gold);
    }

    .terms-container {
      display: flex;
      align-items: center;
      gap: .5rem;
      font-size: .9rem;
      color: var(--text-light);
      margin: 1rem 0;
    }
    .terms-container input {
      width: 1.2rem; height: 1.2rem;
      accent-color: var(--gold);
    }

    button#signup-button {
      width: 100%;
      padding: .75rem;
      border: none;
      border-radius: 6px;
      background: var(--gold);
      color: #000;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      opacity: .6;
      pointer-events: none;
      transition: background .3s ease, opacity .3s ease, box-shadow .3s ease;
    }
    button#signup-button.enabled {
      opacity: 1;
      pointer-events: auto;
      box-shadow: 0 0 8px var(--gold);
    }
    button#signup-button.enabled:hover {
      background: var(--gold-dark);
    }

    #signup-alert {
      margin-top: 1rem;
      min-height: 1.2rem;
      text-align: center;
      font-size: .9rem;
      white-space: pre-wrap;
    }

    footer {
      margin-top: 2rem;
      font-size: .85rem;
      color: var(--text-light);
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="signup-card" id="signup-card">
    <h1>Affiliate Signup</h1>
    <form id="signup-form" novalidate>
      <!-- Username -->
      <div class="form-group">
        <label for="aff-username">Username</label>
        <input type="text" id="aff-username" placeholder="Choose a username" required />
      </div>
      <!-- Email -->
      <div class="form-group">
        <label for="aff-email">Email Address</label>
        <input type="email" id="aff-email" placeholder="you@example.com" required />
      </div>
      <!-- Password -->
      <div class="form-group">
        <label for="aff-password">Password</label>
        <input type="password" id="aff-password" placeholder="Create a password (min 8 chars)" required minlength="8" />
      </div>
      <!-- Confirm Password -->
      <div class="form-group">
        <label for="aff-password-confirm">Confirm Password</label>
        <input type="password" id="aff-password-confirm" placeholder="Re‑enter your password" required />
      </div>
      <!-- Terms & Conditions -->
      <div class="terms-container">
        <input type="checkbox" id="agree-terms" />
        <label for="agree-terms">
          I agree to the
          <a href="https://apexincomeoptions.com.ng/terms" target="_blank" rel="noopener">Terms &amp; Conditions</a>
          and
          <a href="https://apexincomeoptions.com.ng/privacy" target="_blank" rel="noopener">Privacy Policy</a>.
        </label>
      </div>
      <button type="submit" id="signup-button">Sign Up</button>
      <div id="signup-alert" role="alert"></div>
    </form>
  </div>

  <footer>© 2025 Chukwuemeka Bullion Exchange</footer>

  <script>
    // 1) Initialize Supabase
    const SUPA_URL     = "https://dapwpgvnfjcfqqhrpxla.supabase.co";
    const SUPA_ANON_KEY = 
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9."
      + "eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhcHdwZ3Zu"
      + "ZmpjZnFxaHJweGxhIiwicm9sZSI6ImFub24iLCJpYXQiOj"
      + "E3NDcwNDA4ODgsImV4cCI6MjA2MjYxNjg4OH0."
      + "ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ";
    const supabase = supabase.createClient(SUPA_URL, SUPA_ANON_KEY);

    // 2) Basic email validation
    function isValidEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }

    // 3) On DOM ready
    document.addEventListener("DOMContentLoaded", () => {
      const card      = document.getElementById("signup-card");
      const form      = document.getElementById("signup-form");
      const agree     = document.getElementById("agree-terms");
      const btn       = document.getElementById("signup-button");
      const alertDiv  = document.getElementById("signup-alert");

      // Fade in
      setTimeout(() => card.classList.add("visible"), 100);

      // Enable button only when terms are checked
      agree.addEventListener("change", () => {
        const ok = agree.checked;
        btn.classList.toggle("enabled", ok);
      });

      // Handle submit
      form.addEventListener("submit", async e => {
        e.preventDefault();
        alertDiv.textContent = "";
        alertDiv.style.color   = "";

        // Gather
        const username   = document.getElementById("aff-username").value.trim();
        const email      = document.getElementById("aff-email").value.trim().toLowerCase();
        const password   = document.getElementById("aff-password").value;
        const confirmPw  = document.getElementById("aff-password-confirm").value;

        // Validation
        if (!username||!email||!password||!confirmPw) {
          alertDiv.style.color = "var(--error-color)";
          return alertDiv.textContent = "All fields are required.";
        }
        if (!isValidEmail(email)) {
          alertDiv.style.color = "var(--error-color)";
          return alertDiv.textContent = "Enter a valid email.";
        }
        if (password.length < 8) {
          alertDiv.style.color = "var(--error-color)";
          return alertDiv.textContent = "Password must be ≥ 8 chars.";
        }
        if (password !== confirmPw) {
          alertDiv.style.color = "var(--error-color)";
          return alertDiv.textContent = "Passwords do not match.";
        }

        // Disable UI
        btn.disabled = true;
        btn.textContent = "Registering…";

        // Sign up via Supabase Auth, storing `username` in user_metadata
        const { data, error } = await supabase.auth.signUp({
          email: email,
          password: password,
          options: {
            data: { username: username }
          }
        });

        if (error) {
          console.error("SignUp error:", error);
          alertDiv.style.color = "var(--error-color)";
          alertDiv.textContent = error.message;
          btn.disabled = false;
          btn.textContent = "Sign Up";
          return;
        }

        // Success
        alertDiv.style.color = "var(--success-color)";
        alertDiv.textContent = data.user?.confirmation_sent_at
          ? "Check your email to confirm your account."
          : "Signup successful! Redirecting…";

        // Redirect to login after short delay
        setTimeout(() => {
          window.location.href = "affiliate_login.html";
        }, 2000);
      });
    });
  </script>
</body>
</html>
