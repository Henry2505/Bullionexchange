<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Join the Chukwuemeka Bullion Exchange VIP trading community." />
  <title>Apply ‚Ä¢ Chukwuemeka Bullion Exchange</title>

  <!-- Fonts & Icons -->
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&display=swap"
    rel="stylesheet"
  />
  <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

  <style>
    :root[data-theme="dark"] {
      --bg: #121212; --text: #f0f0f0;
      --gold: #d4af37; --gold-dark: #b3932b;
      --glass-bg: rgba(30,30,30,0.6);
      --text-light: #bbbbbb; --border: #333;
    }
    :root[data-theme="light"] {
      --bg: #fafafa; --text: #222;
      --gold: #d4af37; --gold-dark: #b3932b;
      --glass-bg: rgba(255,255,255,0.6);
      --text-light: #555; --border: #ddd;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
      font-family:'Roboto',sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; position:relative;
    }
    a { color:var(--gold); text-decoration:none; }
    a:hover { text-decoration:underline; }

    /* Header Bar */
    .header-bar {
      position:fixed; top:0; left:0; right:0; height:70px;
      background:rgba(0,0,0,0.8); backdrop-filter:blur(8px);
      display:flex; align-items:center; justify-content:space-between;
      padding:0 20px; z-index:1000;
    }
    .header-left { display:flex; align-items:center; gap:20px; }
    .logo img {
      width:140px; margin-top:15px;
      cursor:pointer; transition:transform .3s;
    }
    .logo img:hover { transform:scale(1.05); }
    #local-time {
      font-size:1rem; color:var(--gold);
      font-family:'Roboto',sans-serif;
    }
    #theme-toggle, #voice-toggle {
      background:none; border:none; font-size:1.5rem;
      color:var(--gold); cursor:pointer; margin-left:10px;
      transition:transform .3s;
    }
    #theme-toggle:hover, #voice-toggle:hover { transform:scale(1.2); }

    /* Slide‚Äëin animation */
    .slide-in {
      opacity:0; transform:translateY(20px);
      transition:opacity .6s ease-out,transform .6s ease-out;
    }
    .visible { opacity:1; transform:translateY(0); }

    main {
      padding:100px 20px 60px; display:flex; justify-content:center;
    }

    /* Form Card */
    .apply-card {
      max-width:450px; width:100%;
      background:var(--glass-bg); backdrop-filter:blur(10px);
      padding:30px; border-radius:12px;
      box-shadow:0 8px 32px rgba(0,0,0,0.3);
    }
    .apply-card h1 {
      font-family:'Playfair Display',serif;
      font-size:2rem; color:var(--gold);
      text-align:center; margin-bottom:25px;
    }
    .referral-note {
      color:var(--text-light); font-size:0.9rem;
      text-align:center; margin-bottom:15px;
    }
    .form-group { margin-bottom:20px; }
    label {
      display:block; margin-bottom:8px;
      color:var(--text-light); font-weight:500;
    }
    input, textarea {
      width:100%; padding:12px;
      border:1px solid var(--gold); border-radius:8px;
      background:rgba(28,28,28,0.8); color:var(--text);
      transition:box-shadow .3s;
    }
    input:focus, textarea:focus {
      outline:none; box-shadow:0 0 8px var(--gold);
    }
    textarea { resize:vertical; min-height:100px; }

    .terms-container {
      display:flex; align-items:center; gap:10px;
      padding:12px; background:rgba(255,255,255,0.05);
      border:1px solid var(--gold); border-radius:8px;
      margin-bottom:20px;
    }
    .terms-container input {
      width:20px; height:20px; accent-color:var(--gold);
    }

    button {
      width:100%; padding:14px; border:none; border-radius:8px;
      background:var(--gold); color:#000;
      font-size:1rem; font-weight:700; cursor:pointer;
      opacity:.6; pointer-events:none;
      transition:background .3s,opacity .3s,box-shadow .3s;
    }
    button.enabled {
      opacity:1; pointer-events:auto; box-shadow:0 0 10px var(--gold);
    }
    button.enabled:hover { background:var(--gold-dark); }

    #apply-alert {
      margin-top:15px; text-align:center; font-size:.9rem;
      font-weight:600; min-height:24px; color:var(--success-color);
    }

    footer {
      text-align:center; padding:20px 0;
      color:var(--text-light); font-size:.85rem;
    }
    @media(max-width:600px){
      .apply-card { margin-top:120px; padding:20px; }
      .header-bar { padding:0 15px; }
      .logo img { width:120px; margin-top:10px; }
    }
  </style>
</head>
<body>

  <div class="header-bar">
    <div class="header-left">
      <div class="logo">
        <a href="index.html"><img src="CBE_logo.PNG" alt="CBE Logo"></a>
      </div>
      <span id="local-time"></span>
    </div>
    <div>
      <button id="theme-toggle" aria-label="Toggle theme">üåû</button>
      <button id="voice-toggle" aria-label="Play page audio">‚ñ∂Ô∏è</button>
      <audio id="page-audio" src="apply.mp3" preload="auto"></audio>
    </div>
  </div>

  <main>
    <section class="apply-card slide-in" id="apply-card">
      <h1>Apply to Join CBE</h1>
      <p class="referral-note" id="referral-note"></p>

      <form id="apply-form" novalidate>
        <div class="form-group">
          <label for="apply-name">Full Name</label>
          <input type="text" id="apply-name" placeholder="Full Name" required />
        </div>
        <div class="form-group">
          <label for="apply-email">Email Address</label>
          <input type="email" id="apply-email" placeholder="Email Address" required />
        </div>
        <div class="form-group">
          <label for="apply-password">Password</label>
          <input type="password" id="apply-password" placeholder="Password" required />
        </div>
        <div class="form-group">
          <label for="apply-phone">Contact Number</label>
          <input type="tel" id="apply-phone" placeholder="Contact Number" required />
        </div>
        <div class="form-group">
          <label for="apply-message">Trading Experience</label>
          <textarea id="apply-message" placeholder="Tell us about your trading experience" required></textarea>
        </div>
        <div class="form-group optional">
          <label for="apply-referral">Referral Code (optional)</label>
          <input type="text" id="apply-referral" placeholder="Enter code if you have one" />
        </div>
        <div class="terms-container">
          <input type="checkbox" id="agree-terms" />
          <label for="agree-terms">
            I agree to the
            <a href="https://apexincomeoptions.com.ng/privacy" target="_blank">Privacy Policy</a>
            and
            <a href="https://apexincomeoptions.com.ng/terms" target="_blank">Terms & Conditions</a>
          </label>
        </div>
        <button type="submit" id="submit-btn">Submit Application</button>
        <div id="apply-alert" role="alert"></div>
      </form>
    </section>
  </main>

  <footer>¬© 2025 Chukwuemeka Bullion Exchange. All rights reserved.</footer>

  <script>
    // Local time
    function updateLocalTime(){
      const now=new Date();
      document.getElementById('local-time').textContent=
        now.toLocaleString('en-US',{hour:'numeric',minute:'numeric',second:'numeric',hour12:true,timeZone:'Africa/Lagos'})+' WAT';
    }
    setInterval(updateLocalTime,1000); updateLocalTime();

    // Slide in
    document.addEventListener('DOMContentLoaded',()=>{
      const card=document.getElementById('apply-card');
      card.classList.add('visible');
      // referral from URL
      const params=new URLSearchParams(location.search),ref=params.get('ref');
      if(ref){
        document.getElementById('referral-note').textContent='Referred by: '+ref;
        document.getElementById('apply-referral').value=ref;
      }
    });

    // Theme toggle
    const themeBtn=document.getElementById('theme-toggle');
    themeBtn.addEventListener('click',()=>{
      const curr=document.documentElement.getAttribute('data-theme');
      const next=curr==='dark'?'light':'dark';
      document.documentElement.setAttribute('data-theme',next);
      localStorage.setItem('theme',next);
      themeBtn.textContent=next==='dark'?'üåû':'üåú';
    });
    (()=>{
      const saved=localStorage.getItem('theme')||'dark';
      document.documentElement.setAttribute('data-theme',saved);
      themeBtn.textContent=saved==='dark'?'üåû':'üåú';
    })();

    // Voice toggle
    const voiceBtn=document.getElementById('voice-toggle');
    const audio=document.getElementById('page-audio');
    voiceBtn.addEventListener('click',()=>{
      if(audio.paused){ audio.play(); voiceBtn.textContent='‚è∏Ô∏è'; }
      else{ audio.pause(); voiceBtn.textContent='‚ñ∂Ô∏è'; }
    });
    audio.addEventListener('ended',()=>voiceBtn.textContent='‚ñ∂Ô∏è');

    // Referral validation & submission (unchanged)
    const SUPA_URL="https://dapwpgvnfjcfqqhrpxla.supabase.co",
          SUPA_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpZ...";
    const supabaseClient=supabase.createClient(SUPA_URL,SUPA_KEY);

    const form=document.getElementById('apply-form'),
          agree=document.getElementById('agree-terms'),
          submitBtn=document.getElementById('submit-btn'),
          alertDiv=document.getElementById('apply-alert');

    agree.addEventListener('change',()=>{
      const ok=agree.checked;
      submitBtn.disabled=!ok;
      submitBtn.classList.toggle('enabled',ok);
    });

    form.addEventListener('submit',async e=>{
      e.preventDefault();
      alertDiv.textContent=''; alertDiv.style.color='';
      const name=document.getElementById('apply-name').value.trim(),
            email=document.getElementById('apply-email').value.trim().toLowerCase(),
            password=document.getElementById('apply-password').value,
            phone=document.getElementById('apply-phone').value.trim(),
            experience=document.getElementById('apply-message').value.trim(),
            manualRef=document.getElementById('apply-referral').value.trim();

      if(!name||!email||!password||!phone||!experience){
        alertDiv.style.color='var(--error-color)';
        alertDiv.textContent='Please fill all required fields.';
        return;
      }
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
        alertDiv.style.color='var(--error-color)';
        alertDiv.textContent='Enter a valid email.';
        return;
      }
      if(password.length<8){
        alertDiv.style.color='var(--error-color)';
        alertDiv.textContent='Password must be ‚â•8 characters.';
        return;
      }
      submitBtn.disabled=true; submitBtn.textContent='Submitting‚Ä¶';

      try{
        const urlRef=new URLSearchParams(location.search).get('ref'),
              code=manualRef||urlRef||null;
        let referredBy=null;
        if(code){
          const { data, error }=await supabaseClient
            .from('affiliates').select('user_id').eq('referral_code',code).single();
          if(error||!data){
            alertDiv.style.color='var(--error-color)';
            alertDiv.textContent='Invalid referral code.';
            throw error||new Error('No affiliate');
          }
          referredBy=data.user_id;
        }
        const payload={ name,email,password,phone,experience,referral_code:code,referred_by:referredBy };
        const res=await fetch('/.netlify/functions/send-application',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(payload)
        });
        const result=await res.json();
        if(!res.ok){
          throw new Error(result.error||JSON.stringify(result));
        }
        alertDiv.style.color='var(--success-color)';
        alertDiv.textContent=result.message||'Application submitted!';
        form.reset(); agree.checked=false; submitBtn.classList.remove('enabled');
      }catch(err){
        console.error(err);
      }finally{
        submitBtn.disabled=true; submitBtn.textContent='Submit Application';
      }
    });
  </script>
</body>
</html>
