<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minimal CBE Admin</title>
  <style>
    body { font-family: sans-serif; background:#121212; color:#f0f0f0; padding:20px; }
    table { width:100%; border-collapse: collapse; margin-top:20px; }
    th, td { border:1px solid #444; padding:8px; }
    th { background:#1e1e1e; }
  </style>
</head>
<body>
  <h1>Admin â€” User List</h1>
  <button id="refresh">Refresh</button>
  <pre id="debug"></pre>
  <table id="user-table">
    <thead>
      <tr><th>#</th><th>Email</th><th>Name</th><th>Status</th><th>Registered At</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js"></script>
  <script>
    // 1) Initialize client
    const sb = window.supabase.createClient(
      'https://dapwpgvnfjcfqqhrpxla.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSI...ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ'
    );

    async function fetchUsers() {
      try {
        const res = await sb
          .from('users')
          .select('*')
          .order('id', { ascending: false });
        console.log('Supabase response:', res);
        document.getElementById('debug').textContent = JSON.stringify(res, null, 2);

        const tbody = document.querySelector('#user-table tbody');
        tbody.innerHTML = '';
        (res.data || []).forEach((u, i) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${i+1}</td>
            <td>${u.email||''}</td>
            <td>${u.name||''}</td>
            <td>${u.status||''}</td>
            <td>${u.created_at ? new Date(u.created_at).toLocaleString() : ''}</td>
          `;
          tbody.appendChild(tr);
        });
        if (!res.data || res.data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align:center">No users found</td></tr>';
        }
      } catch (err) {
        console.error('Fetch error:', err);
        document.getElementById('debug').textContent = 'Error: ' + err.message;
      }
    }

    document.getElementById('refresh').onclick = fetchUsers;
    fetchUsers();
  </script>
</body>
</html>
