<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <!-- â€¦ your existing head content â€¦ -->
</head>
<body>
  <!-- â€¦ your existing body content â€¦ -->

  <!-- Load Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js"></script>

  <!-- Initialize client (`sb`) & Define Email Endpoint + Template ID -->
  <script>
    const SUPABASE_URL       = 'https://dapwpgvnfjcfqqhrpxla.supabase.co';
    const SUPABASE_ANON_KEY   = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFub24iLCJpYXQiOjE3NDcwNDA4ODgsImV4cCI6MjA2MjYxNjg4OH0.ICC0UsLlzJDNre7rFCeD3k6iVzo6jOJgn3PhABpEMsQ';
    const sb                 = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ NEW: Email endpoint & template â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // (replace TEMPLATE_ID with your actual Brevo welcome template ID)
    const EMAIL_API_URL       = 'https://e45486b0-133d-4465-bbcf-159efe9abcb4-00-tc32jfdcbfn4.janeway.replit.dev/resend-email';
    const WELCOME_TEMPLATE_ID = 456;  

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Slide-in effect & Theme toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('apply-card').classList.add('visible');
      document.getElementById('theme-toggle').textContent =
        document.documentElement.getAttribute('data-theme') === 'dark' ? 'ðŸŒž' : 'ðŸŒœ';
    });
    document.getElementById('theme-toggle').addEventListener('click', () => {
      const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      document.getElementById('theme-toggle').textContent = next === 'dark' ? 'ðŸŒž' : 'ðŸŒœ';
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Form logic with Welcome-email trigger â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const form          = document.getElementById('apply-form');
    const agreeCheckbox = document.getElementById('agree-terms');
    const submitBtn     = document.getElementById('submit-btn');
    const alertDiv      = document.getElementById('apply-alert');

    agreeCheckbox.addEventListener('change', () => {
      submitBtn.classList.toggle('enabled', agreeCheckbox.checked);
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();
      alertDiv.textContent = '';

      if (!agreeCheckbox.checked) {
        alertDiv.style.color = 'crimson';
        return alertDiv.textContent = 'You must agree to the Privacy Policy and Terms to continue.';
      }

      // read fields
      const name       = form['apply-name'].value.trim();
      const email      = form['apply-email'].value.trim().toLowerCase();
      const password   = form['apply-password'].value;
      const phone      = form['apply-phone'].value.trim();
      const experience = form['apply-message'].value.trim();

      // basic validation
      if (!name || !email || !password || !phone || !experience) {
        alertDiv.style.color = 'crimson';
        return alertDiv.textContent = 'Please complete all fields.';
      }
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alertDiv.style.color = 'crimson';
        return alertDiv.textContent = 'Please enter a valid email address.';
      }

      // insert into Supabase
      try {
        const { error } = await sb
          .from('users')
          .insert([{ name, email, phone, password, experience, status: 'Pending' }]);

        if (error) throw error;

        // show success
        alertDiv.style.color = 'lightgreen';
        alertDiv.textContent = 'Application submittedâ€”thank you!';
        form.reset();
        submitBtn.classList.remove('enabled');

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ NEW: send Welcome Email â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const firstName = name.split(' ')[0] || name;
        await fetch(EMAIL_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email,
            templateId: WELCOME_TEMPLATE_ID,
            params: {
              FIRSTNAME: firstName
            }
          })
        });
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      } catch (err) {
        console.error(err);
        alertDiv.style.color = 'crimson';
        alertDiv.textContent = `Error: ${err.message}`;
      }
    });
  </script>

  <!-- Smartsupp Live Chat script -->
  <script type="text/javascript">
    /* â€¦ your existing Smartsupp code â€¦ */
  </script>
</body>
</html>
